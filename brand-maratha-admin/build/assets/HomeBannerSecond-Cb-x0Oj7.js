import{j as e,a,C as ye}from"./index-f6D6TMGS.js";import{b as X}from"./index.esm-B7prAHhm.js";import{r as re,A as be,B as ke,C as Fe,D as Se,E as we,F as Be,G as Ie,H as Ne}from"./api.endpoints-D7eIfK11.js";import{C as oe,a as o}from"./CRow-C5aZ3uce.js";import{C as ce,a as me}from"./CCardBody-DyHbCEEC.js";import{C as $}from"./CCardHeader-BkEnHaV2.js";import{C as _e,a as ve,b as Y,c as S,d as Te,e as P}from"./CTable-Bj0B-88c.js";import{C as p}from"./CButton-ByJ5g7iZ.js";import{c as De}from"./cil-pen-53d2I-C-.js";import{c as Ee}from"./cil-trash-CBbKHhHb.js";import{a as R}from"./axios.config-D8NC-S8h.js";import{M as Pe}from"./Modal-Byr5KNe-.js";import{c as Z,a as ee,b as te,F as se}from"./formik.esm-DzZc3OM4.js";import{h as M}from"./errorHelper-EbapN-iz.js";import{I as ae,a as ne}from"./ImagePreview-BEQ8m4jE.js";import{C as Re}from"./CFormSelect-BM6fWH_8.js";import{C as ie}from"./CForm-BElthXFv.js";import{C as w,a as B}from"./CFormControlWrapper-aXjT4m4y.js";import{C as I}from"./CFormInput-CzlD-ECf.js";import{C as le}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";import"./index-C7_v8csn.js";const Me=({banners:i,formData:z,handleDelete:d,setActiveForm:L,setShowForm:x})=>{const j=s=>{z(s),L(!0),x(!0)};return e.jsx(oe,{children:e.jsx(o,{xs:12,children:e.jsxs(ce,{className:"mb-4",children:[e.jsxs($,{children:[e.jsx("strong",{children:"Banner"})," ",e.jsx("small",{children:"List"})]}),e.jsx(me,{children:(i==null?void 0:i.length)>0?e.jsxs(_e,{hover:!0,children:[e.jsx(ve,{children:e.jsxs(Y,{children:[e.jsx(S,{scope:"col",children:"Index"}),e.jsx(S,{scope:"col",children:"Title"}),e.jsx(S,{scope:"col",children:"Link"}),e.jsx(S,{scope:"col",children:"Image"}),e.jsx(S,{scope:"col",children:"Action"})]})}),e.jsx(Te,{children:i==null?void 0:i.map((s,C)=>e.jsx(a.Fragment,{children:e.jsxs(Y,{children:[e.jsx(S,{scope:"row",children:C+1}),e.jsx(P,{children:s!=null&&s.title?s==null?void 0:s.title:"-"}),e.jsx(P,{children:s!=null&&s.link?s==null?void 0:s.link:"-"}),e.jsx(P,{children:e.jsx("img",{src:re+s.image,height:"40px",width:"auto"})}),e.jsx(P,{children:e.jsxs(o,{style:{display:"flex",alignItems:"center"},children:[e.jsx(p,{type:"button",color:"success",onClick:()=>j(s),children:e.jsx(X,{icon:De,size:"md"})}),e.jsx(p,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>d(s==null?void 0:s.id),children:e.jsx(X,{icon:Ee,size:"md"})})]})})]})},C))})]}):e.jsx($,{children:e.jsx("strong",{children:"No banner found!"})})})]})})})},ot=()=>{const[i,z]=a.useState([]),[d,L]=a.useState("english"),[x,j]=a.useState(!1),[s,C]=a.useState(!1),[m,de]=a.useState(null),[he,A]=a.useState(!1),[ue,G]=a.useState(null),[y,H]=a.useState({}),[b,U]=a.useState(null),[pe,h]=a.useState(!1),[_,k]=a.useState(""),[v,f]=a.useState(""),O=a.useRef(!0),F=a.useRef(null),[q,V]=a.useState(null),[W,T]=a.useState(!1),[J,D]=a.useState(!1),xe=Z().shape({link:te().url("Invalid URL format"),image:ee().nullable().test("fileRequired","Image is required",function(t){const{existing_image:l}=this.parent;return!l&&!t?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>12*1024*1024?this.createError({message:"File exceeds 12MB limit"}):!0})}),fe=Z().shape({link:te().url("Invalid URL format"),image:ee().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>12*1024*1024?this.createError({message:"File exceeds 12MB limit"}):!0})});a.useEffect(()=>{de({getBanner:d==="english"?Ie:Ne,postBanner:d==="english"?we:Be,putBanner:d==="english"?Fe:Se,deleteBanner:d==="english"?be:ke})},[d]),a.useEffect(()=>{if(O.current){O.current=!1;return}m&&E(m)},[m]),a.useEffect(()=>{U(y.image||"")},[y.image]),a.useEffect(()=>{if(_||v){const t=setTimeout(()=>{k(""),f("")},3e3);return()=>clearTimeout(t)}},[_,v]);const E=async t=>{h(!0);try{const{data:l}=await R.get(t.getBanner);z(l)}catch(l){f(M(l))}finally{h(!1)}};async function ge(t,{resetForm:l}){f(""),k(""),h(!0);const c={title:t.title.trim(),link:t.link.trim()},r=new FormData;r.append("title",c.title),r.append("link",c.link),r.append("image",t.image);try{const{data:n}=await R.post(m.postBanner,r,{headers:{"Content-Type":"multipart/form-data"}});k("Banner created successfully!"),E(m),F.current&&(F.current.value=""),l(),j(!1)}catch(n){f(M(n))}finally{h(!1)}}const je=t=>{G(t),A(!0)};async function Ce(){h(!0);try{await R.delete(`${m.deleteBanner}/${ue}`),E(m),C(!1)}catch(t){f(M(t))}finally{A(!1),G(null),h(!1)}}async function K(t,{resetForm:l}){f(""),k(""),h(!0);const c={title:t.title.trim(),link:t.link.trim()};if(y.id===null){k("Please select first banner.");return}const r=new FormData;r.append("title",c.title),r.append("link",c.link),r.append("image",t.image);try{await R.put(`${m.putBanner}/${y.id}`,r,{headers:{"Content-Type":"multipart/form-data"}}),k("Banner updated successfully!"),E(m),F.current&&(F.current.value=""),l(),H({}),U(""),j(!1)}catch(n){f(M(n))}finally{h(!1)}}const Q=()=>{j(!x),C(!1)};return pe?e.jsx(ye,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(e.Fragment,{children:e.jsxs(oe,{children:[e.jsxs(o,{xs:12,children:[e.jsxs(ce,{className:"mb-4",children:[e.jsxs($,{children:[e.jsxs("strong",{children:[" ",s?"Update":"Add"]})," ",e.jsx("small",{children:"Banner"})]}),e.jsxs(me,{className:"row g-3",children:[e.jsx(o,{xs:12,md:4,lg:2,children:e.jsxs(Re,{"aria-label":"Default select example",value:d,onChange:t=>L(t.target.value),disabled:x,children:[e.jsx("option",{value:"english",children:"English"}),e.jsx("option",{value:"marathi",children:"मराठी"})]})}),e.jsx(o,{xs:12,md:6,children:(i==null?void 0:i.length)<7?e.jsx(p,{as:"input",type:"button",color:"primary",value:x?"Close":"Add",onClick:Q}):x&&e.jsx(p,{as:"input",type:"button",color:"primary",value:"Close",onClick:Q})}),x?s?e.jsx(e.Fragment,{children:e.jsx(se,{initialValues:{title:y.title||"",link:y.link||"",image:null},enableReinitialize:!0,validationSchema:fe,onSubmit:K,children:({values:t,setFieldValue:l,handleChange:c,handleSubmit:r,errors:n,touched:g})=>e.jsxs(ie,{className:"row g-3",onSubmit:r,children:[e.jsxs(o,{md:4,children:[e.jsx(w,{htmlFor:"title",children:"Title"}),e.jsx(I,{type:"text",name:"title",value:t.title,onChange:c}),n.title&&g.title&&e.jsx(B,{className:"text-danger small",children:n.title})]}),e.jsxs(o,{md:4,children:[e.jsx(w,{htmlFor:"link",children:"Link"}),e.jsx(I,{type:"text",name:"link",value:t.link,onChange:c}),n.link&&g.link&&e.jsx(B,{className:"text-danger small",children:n.link})]}),e.jsxs(o,{md:4,children:[e.jsxs(w,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(I,{type:"file",accept:"image/*",name:"image",onChange:u=>{const N=u.target.files[0];N&&(V(N),T(!0))},ref:F}),b&&e.jsx(p,{color:"primary",size:"md",type:"button",onClick:()=>D(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(ae,{show:W,imageFile:q,onClose:()=>T(!1),onCropDone:u=>{l("image",u),U(URL.createObjectURL(u))}}),e.jsx(ne,{visible:J,imageFile:b!=null&&b.startsWith("blob:")?b:re+b,onClose:()=>D(!1)})]}),n.image&&g.image&&e.jsx(B,{className:"text-danger small",children:n.image})]}),e.jsx(o,{xs:12,children:e.jsx(p,{color:"primary",type:"submit",children:"Update"})})]})})}):(i==null?void 0:i.length)<7&&e.jsx(se,{initialValues:{title:"",link:"",image:null},enableReinitialize:!0,validationSchema:xe,onSubmit:ge,children:({values:t,setFieldValue:l,handleChange:c,handleSubmit:r,errors:n,touched:g})=>e.jsxs(ie,{className:"row g-3",onSubmit:r,children:[e.jsxs(o,{md:4,children:[e.jsx(w,{htmlFor:"title",children:"Title"}),e.jsx(I,{type:"text",name:"title",value:t.title,onChange:c}),n.title&&g.title&&e.jsx(B,{className:"text-danger small",children:n.title})]}),e.jsxs(o,{md:4,children:[e.jsx(w,{htmlFor:"link",children:"Link"}),e.jsx(I,{type:"text",name:"link",value:t.link,onChange:c}),n.link&&g.link&&e.jsx(B,{className:"text-danger small",children:n.link})]}),e.jsxs(o,{md:4,children:[e.jsxs(w,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(I,{type:"file",accept:"image/*",name:"image",onChange:u=>{const N=u.target.files[0];N&&(V(N),T(!0))},ref:F}),t.image&&e.jsx(p,{color:"primary",size:"md",type:"button",onClick:()=>D(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(ae,{show:W,imageFile:q,onClose:()=>T(!1),onCropDone:u=>{l("image",u)}}),e.jsx(ne,{visible:J,imageFile:t.image,onClose:()=>D(!1)})]}),n.image&&g.image&&e.jsx(B,{className:"text-danger small",children:n.image})]}),e.jsx(o,{xs:12,children:e.jsx(p,{color:"primary",type:"submit",children:"Submit"})})]})}):null]})]}),e.jsxs("div",{className:"mt-4",children:[_&&e.jsx(le,{color:"primary",children:_}),v&&e.jsx(le,{color:"danger",children:v})]}),e.jsx(Me,{banners:i,formData:H,handleDelete:je,handleUpdate:K,setActiveForm:C,setShowForm:j})]}),e.jsx(Pe,{visible:he,onClose:()=>A(!1),onConfirm:Ce,title:"Confirm Delete",message:"Are you sure you want to delete this banner?"})]})})};export{ot as default};
