import{j as e,a as t,C as be}from"./index-f6D6TMGS.js";import{a as _}from"./axios.config-D8NC-S8h.js";import{r as oe,a1 as we,a2 as Fe,a3 as Se,a4 as De,a5 as Ne,a6 as _e,a7 as Ie,a8 as Ee}from"./api.endpoints-D7eIfK11.js";import{M as Je}from"./Modal-Byr5KNe-.js";import{b as K}from"./index.esm-B7prAHhm.js";import{C as le,a as l}from"./CRow-C5aZ3uce.js";import{C as ce,a as de}from"./CCardBody-DyHbCEEC.js";import{C as L}from"./CCardHeader-BkEnHaV2.js";import{C as Te,a as Pe,b as Q,c as k,d as ve,e as A}from"./CTable-Bj0B-88c.js";import{C as g}from"./CButton-ByJ5g7iZ.js";import{c as Me}from"./cil-pen-53d2I-C-.js";import{c as Re}from"./cil-trash-CBbKHhHb.js";import{c as X,a as Y,b as Z,F as ee}from"./formik.esm-DzZc3OM4.js";import{h as I}from"./errorHelper-EbapN-iz.js";import{I as se,a as te}from"./ImagePreview-BEQ8m4jE.js";import{C as ze}from"./CFormSelect-BM6fWH_8.js";import{C as ae}from"./CForm-BElthXFv.js";import{C as E,a as J}from"./CFormControlWrapper-aXjT4m4y.js";import{C as ie}from"./CFormTextarea-3GaLNVd-.js";import{C as re}from"./CFormInput-CzlD-ECf.js";import{C as ne}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";import"./index-C7_v8csn.js";const ke=({journey:i,formData:T,handleDelete:d,setActiveForm:P,setShowForm:x})=>{const m=a=>{T(a),P(!0),x(!0)};return e.jsx(le,{children:e.jsx(l,{xs:12,children:e.jsxs(ce,{className:"mb-4",children:[e.jsxs(L,{children:[e.jsx("strong",{children:"Journey"})," ",e.jsx("small",{children:"List"})]}),e.jsx(de,{children:(i==null?void 0:i.length)>0?e.jsxs(Te,{hover:!0,children:[e.jsx(Pe,{children:e.jsxs(Q,{children:[e.jsx(k,{scope:"col",children:"Description"}),e.jsx(k,{scope:"col",width:120,children:"Image"}),e.jsx(k,{scope:"col",width:150,children:"Action"})]})}),e.jsx(ve,{children:i==null?void 0:i.map((a,j)=>e.jsx(t.Fragment,{children:e.jsxs(Q,{children:[e.jsx(A,{style:{width:"35rem"},children:a==null?void 0:a.description}),e.jsx(A,{width:120,children:e.jsx("img",{src:oe+a.image,height:"40px",width:"auto"})}),e.jsxs(A,{width:150,children:[e.jsx(g,{type:"button",color:"success",onClick:()=>m(a),children:e.jsx(K,{icon:Me,size:"md"})}),e.jsx(g,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>d(a==null?void 0:a.id),children:e.jsx(K,{icon:Re,size:"md"})})]})]})},j))})]}):e.jsx(L,{children:e.jsx("strong",{children:"No journey found!"})})})]})})})},ds=()=>{const[i,T]=t.useState([]),[d,P]=t.useState("english"),[x,m]=t.useState(""),[a,j]=t.useState(!1),[v,M]=t.useState(!1),[c,me]=t.useState(null),[ue,R]=t.useState(!1),[pe,q]=t.useState(null),[y,he]=t.useState({}),[C,z]=t.useState(null),[ge,u]=t.useState(!1),[F,p]=t.useState(""),B=t.useRef(!0),U=t.useRef(null),[$,O]=t.useState(null),[G,S]=t.useState(!1),[H,D]=t.useState(!1),fe=X().shape({description:Z().required("Description is required").test("no-whitespace","Cannot be only spaces",s=>s&&s.trim().length>0),image:Y().nullable().test("fileRequired","Image is required",function(s){const{existing_image:n}=this.parent;return!n&&!s?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",s=>!s||typeof s!="object"?!0:["image/jpeg","image/png","image/webp"].includes(s.type)).test("fileSize","File size must be less than 5MB",function(s){return!s||typeof s!="object"?!0:s.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})}),xe=X().shape({description:Z().required("Description is required").test("no-whitespace","Cannot be only spaces",s=>s&&s.trim().length>0),image:Y().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",s=>!s||typeof s!="object"?!0:["image/jpeg","image/png","image/webp"].includes(s.type)).test("fileSize","File size must be less than 5MB",function(s){return!s||typeof s!="object"?!0:s.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})});t.useEffect(()=>{me({getJourney:d==="english"?Ie:Ee,postJourney:d==="english"?Ne:_e,putJourney:d==="english"?Se:De,deleteJourney:d==="english"?we:Fe})},[d]),t.useEffect(()=>{if(B.current){B.current=!1;return}c&&N(c)},[c]),t.useEffect(()=>{if(x||F){const s=setTimeout(()=>{m(""),p("")},3e3);return()=>clearTimeout(s)}},[x,F]),t.useEffect(()=>{z(y.image||"")},[y.image]);const N=async s=>{u(!0);try{const{data:n}=await _.get(s.getJourney);T(n)}catch(n){p(I(n))}finally{u(!1)}};async function je(s,{resetForm:n}){u(!0),p(""),m("");const f={description:s.description.trim()},o=new FormData;o.append("description",f.description),o.append("image",s.image);try{const{data:r}=await _.post(c.postJourney,o,{headers:{"Content-Type":"multipart/form-data"}});m("Record created successfull!"),N(c),j(!1),n()}catch(r){p(I(r))}finally{u(!1)}}const Ce=s=>{q(s),R(!0)};async function ye(){u(!0),p("");try{await _.delete(`${c.deleteJourney}/${pe}`),N(c),M(!1)}catch(s){p(I(s))}finally{R(!1),q(null),u(!1)}}async function V(s,{resetForm:n}){if(u(!0),p(""),m(""),y.id===null){m("Please select a banner first.");return}const f={description:s.description.trim()},o=new FormData;o.append("description",f.description),s.image instanceof File&&o.append("image",s.image);try{await _.put(`${c.putJourney}/${y.id}`,o,{headers:{"Content-Type":"multipart/form-data"}}),m("Journey updated successfully!"),N(c),z(""),j(!1),n()}catch(r){p(I(r))}finally{u(!1)}}const W=()=>{j(!a),M(!1)};return ge?e.jsx(be,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(e.Fragment,{children:e.jsxs(le,{children:[e.jsxs(l,{xs:12,children:[e.jsxs(ce,{className:"mb-4",children:[e.jsxs(L,{children:[e.jsxs("strong",{children:[" ",v?"Update":"Add"]})," ",e.jsx("small",{children:"our journey"})]}),e.jsxs(de,{className:"row g-3",children:[e.jsx(l,{xs:12,md:4,lg:2,children:e.jsxs(ze,{"aria-label":"Default select example",value:d,onChange:s=>P(s.target.value),disabled:a,children:[e.jsx("option",{value:"english",children:"English"}),e.jsx("option",{value:"marathi",children:"मराठी"})]})}),e.jsx(l,{xs:12,md:6,children:!(i!=null&&i.length)>0?e.jsx(g,{as:"input",type:"button",color:"primary",value:a!==!0?"Add":"Close",onClick:()=>W()}):!v||a&&e.jsx(g,{as:"input",type:"button",color:"primary",value:"Close",onClick:()=>W()})}),a?v?e.jsx(e.Fragment,{children:e.jsx(ee,{initialValues:{description:y.description||"",image:null},enableReinitialize:!0,validationSchema:xe,onSubmit:V,children:({values:s,setFieldValue:n,handleChange:f,handleSubmit:o,errors:r,touched:b})=>e.jsxs(ae,{className:"row g-3",onSubmit:o,children:[e.jsxs(l,{md:12,children:[e.jsxs(E,{htmlFor:"description",children:["Description",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(ie,{type:"text",name:"description",value:s.description,onChange:f}),r.description&&b.description&&e.jsx(J,{className:"text-danger small",children:r.description})]}),e.jsxs(l,{md:12,children:[e.jsxs(E,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(re,{type:"file",accept:"image/*",name:"image",onChange:h=>{const w=h.target.files[0];w&&(O(w),S(!0))},ref:U}),C&&e.jsx(g,{color:"primary",size:"md",type:"button",onClick:()=>D(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(se,{show:G,imageFile:$,onClose:()=>S(!1),onCropDone:h=>{n("image",h),z(URL.createObjectURL(h))}}),e.jsx(te,{visible:H,imageFile:C!=null&&C.startsWith("blob:")?C:oe+C,onClose:()=>D(!1)})]}),r.image&&b.image&&e.jsx(J,{className:"text-danger small",children:r.image})]}),e.jsx(l,{xs:12,children:e.jsx(g,{color:"primary",type:"submit",children:"Update"})})]})})}):!(i!=null&&i.length)>0&&e.jsx(ee,{initialValues:{description:"",image:null},enableReinitialize:!0,validationSchema:fe,onSubmit:je,children:({values:s,setFieldValue:n,handleChange:f,handleSubmit:o,errors:r,touched:b})=>e.jsxs(ae,{className:"row g-3 needs-validation",onSubmit:o,children:[e.jsxs(l,{md:12,children:[e.jsxs(E,{htmlFor:"description",children:["Description",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(ie,{type:"text",name:"description",value:s.description,onChange:f}),r.description&&b.description&&e.jsx(J,{className:"text-danger small",children:r.description})]}),e.jsxs(l,{md:12,children:[e.jsxs(E,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(re,{type:"file",accept:"image/*",name:"image",onChange:h=>{const w=h.target.files[0];w&&(O(w),S(!0))},ref:U}),s.image&&e.jsx(g,{color:"primary",size:"md",type:"button",onClick:()=>D(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(se,{show:G,imageFile:$,onClose:()=>S(!1),onCropDone:h=>{n("image",h)}}),e.jsx(te,{visible:H,imageFile:s.image,onClose:()=>D(!1)})]}),r.image&&b.image&&e.jsx(J,{className:"text-danger small",children:r.image})]}),e.jsx(l,{xs:12,children:e.jsx(g,{color:"primary",type:"submit",children:"Submit"})})]})}):null]})]}),e.jsxs("div",{className:"mt-4",children:[x&&e.jsx(ne,{color:"primary",children:x}),F&&e.jsx(ne,{color:"danger",children:F})]}),e.jsx(ke,{journey:i,formData:he,handleDelete:Ce,handleUpdate:V,setActiveForm:M,setShowForm:j})]}),e.jsx(Je,{visible:ue,onClose:()=>R(!1),onConfirm:ye,title:"Confirm Delete",message:"Are you sure you want to delete this our journey?"})]})})};export{ds as default};
