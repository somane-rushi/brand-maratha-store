import{a as t,j as e,C as ce}from"./index-f6D6TMGS.js";import{a as F}from"./axios.config-D8NC-S8h.js";import{b9 as me,ba as ue,bb as he,bc as pe}from"./api.endpoints-D7eIfK11.js";import{M as fe}from"./Modal-Byr5KNe-.js";import{b as A}from"./index.esm-B7prAHhm.js";import{C as W,a as B}from"./CRow-C5aZ3uce.js";import{C as G,a as J}from"./CCardBody-DyHbCEEC.js";import{C as E}from"./CCardHeader-BkEnHaV2.js";import{C as xe,a as ve,b as R,c as V,d as je,e as $}from"./CTable-Bj0B-88c.js";import{C as p}from"./CButton-ByJ5g7iZ.js";import{c as ye}from"./DefaultLayout-BE9qYLzL.js";import{c as ge}from"./cil-pen-53d2I-C-.js";import{c as Ce}from"./cil-trash-CBbKHhHb.js";import{C as K,a as Q,b as X}from"./CModalHeader-fVen3JA5.js";import{F as L,c as Z,a as ee}from"./formik.esm-DzZc3OM4.js";import{h as M}from"./errorHelper-EbapN-iz.js";import{C as U}from"./CForm-BElthXFv.js";import{C as q,a as O}from"./CFormControlWrapper-aXjT4m4y.js";import{C as H}from"./CFormInput-CzlD-ECf.js";import{C as Y}from"./CAlert-Ceafrkex.js";import"./CModalTitle-AQ6XSAyd.js";import"./cil-user-Ddrdy7PS.js";var be={};const we=({banners:i,formData:j,handleDelete:m,setActiveForm:n,setShowForm:f})=>{const[x,h]=t.useState(!1),[r,C]=t.useState(""),y=o=>{j(o),n(!0),f(!0)},N=o=>{C(o),h(!0)},b=()=>{h(!1),C("")};return e.jsxs(W,{children:[e.jsx(B,{xs:12,children:e.jsxs(G,{className:"mb-4",children:[e.jsxs(E,{children:[e.jsx("strong",{children:"Banner"})," ",e.jsx("small",{children:"List"})]}),e.jsx(J,{children:(i==null?void 0:i.length)>0?e.jsxs(xe,{hover:!0,children:[e.jsx(ve,{children:e.jsxs(R,{children:[e.jsx(V,{scope:"col",children:"Index"}),e.jsx(V,{scope:"col",children:"Video"}),e.jsx(V,{scope:"col",children:"Action"})]})}),e.jsx(je,{children:i==null?void 0:i.map((o,g)=>e.jsx(t.Fragment,{children:e.jsxs(R,{children:[e.jsx(V,{scope:"row",children:g+1}),e.jsx($,{children:o.video?e.jsxs(p,{color:"primary",size:"sm",onClick:()=>N(o.video),children:[e.jsx(A,{icon:ye,size:"sm"})," Play Video"]}):"No Video Available"}),e.jsxs($,{children:[e.jsx(p,{type:"button",color:"success",onClick:()=>y(o),children:e.jsx(A,{icon:ge,size:"md"})}),e.jsx(p,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>m(o==null?void 0:o.id),children:e.jsx(A,{icon:Ce,size:"md"})})]})]})},g))})]}):e.jsx(E,{children:e.jsx("strong",{children:"No banner found!"})})})]})}),e.jsxs(K,{visible:x,onClose:b,size:"lg",children:[e.jsx(Q,{closeButton:!0,children:"Video Preview"}),e.jsx(X,{className:"d-flex justify-content-center",children:r?/youtu\.?be|youtube\.com/.test(r)?e.jsx("iframe",{width:"100%",height:"400",src:r.includes("youtube.com/watch")?r.replace("watch?v=","embed/").split("&")[0]:r.includes("youtu.be/")?`https://www.youtube.com/embed/${r.split("youtu.be/")[1].split("?")[0]}`:"",title:"YouTube Video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):e.jsxs("video",{width:"100%",height:"400",controls:!0,autoPlay:!0,children:[e.jsx("source",{src:r.startsWith("http")?r:`${be.REACT_APP_BASE_URL||""}/${r}`,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsx("p",{children:"No Video Available"})})]})]})},Se=Z().shape({video:ee().required("Video is required").test("is-valid-video","Invalid video input",function(i){return typeof window<"u"&&i instanceof File?["video/mp4","video/quicktime","video/x-msvideo"].includes(i.type)?i.size>20*1024*1024?this.createError({message:"File exceeds 20MB limit"}):!0:this.createError({message:"Only MP4, MOV, AVI formats are allowed"}):this.createError({message:"Please upload a valid video file"})})}),Fe=Z().shape({video:ee().required("Video is required").test("is-valid-video","Invalid video input",function(i){return typeof window<"u"&&i instanceof File?["video/mp4","video/quicktime","video/x-msvideo"].includes(i.type)?i.size>20*1024*1024?this.createError({message:"File exceeds 20MB limit"}):!0:this.createError({message:"Only MP4, MOV, AVI formats are allowed"}):this.createError({message:"Please upload a valid video file"})})}),Ge=()=>{const[i,j]=t.useState([]),[m,n]=t.useState(""),[f,x]=t.useState(!1),[h,r]=t.useState(!1),[C,y]=t.useState(!1),[N,b]=t.useState(null),[o,g]=t.useState({}),[se,u]=t.useState(!1),[w,d]=t.useState(""),v=t.useRef(null),[te,_]=t.useState(!1),[I,ie]=t.useState(""),[D,T]=t.useState({image:o.thumbnail||"",video:o.video||""});t.useEffect(()=>{S()},[]),t.useEffect(()=>{if(m||w){const s=setTimeout(()=>{n(""),d("")},3e3);return()=>clearTimeout(s)}},[m,w]),t.useEffect(()=>{const{thumbnail:s,video:c}=o;(s||c)&&T({image:s,video:c})},[o]);const S=async()=>{u(!0),d("");try{const{data:s}=await F.get(me);j(s)}catch(s){d(M(s))}finally{u(!1)}},oe=async(s,{resetForm:c})=>{u(!0),d(""),n("");const a=new FormData;s.video&&a.append("video",s.video);try{const{data:l}=await F.post(ue,a,{headers:{"Content-Type":"multipart/form-data"}});n(l==null?void 0:l.message),S(),v.current&&(v.current.value=""),x(!1)}catch(l){d(M(l))}finally{u(!1)}},k=async(s,{resetForm:c})=>{if(u(!0),n(""),d(""),!o.id){n("Please select a banner first.");return}const a=new FormData;s.video instanceof File&&a.append("video",s.video);try{await F.put(`${he}/${o.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}),n("Banner updated successfully!"),S(),v.current&&(v.current.value=""),g({}),T({video:""}),x(!1),c()}catch(l){d(M(l))}finally{u(!1)}},re=s=>{b(s),y(!0)},ae=async()=>{u(!0),d("");try{await F.delete(`${pe}/${N}`),S(),r(!1)}catch(s){d(M(s))}finally{y(!1),b(null),u(!1)}},le=()=>{x(!f),r(!1)},ne=s=>{ie(s),_(!0)};return se?e.jsx(ce,{color:"primary"}):e.jsxs(W,{children:[e.jsxs(B,{xs:12,children:[e.jsxs(G,{className:"mb-4",children:[e.jsxs(E,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:h?"Update":"Add"})," ",e.jsx("small",{children:"banner"})]}),(i.length<2||f&&h)&&e.jsx(p,{type:"button",color:"primary",onClick:le,children:f&&h?"Close":"Add"})]}),f&&e.jsx(J,{className:"row g-3",children:!h&&i.length<2?e.jsx(L,{initialValues:{video:null},enableReinitialize:!0,validationSchema:Se,onSubmit:oe,children:({setFieldValue:s,handleSubmit:c,errors:a,touched:l})=>e.jsx(U,{className:"row g-3",onSubmit:c,children:e.jsxs(B,{md:6,children:[e.jsxs(q,{htmlFor:"video",children:["Video ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx(H,{type:"file",accept:"video/*",name:"video",onChange:P=>s("video",P.target.files[0]),ref:v}),e.jsx(p,{color:"primary",type:"submit",children:"Submit"})]}),a.video&&l.video&&e.jsx(O,{className:"text-danger small d-block mt-1",children:a.video})]})})}):e.jsx(L,{initialValues:{video:o.video||null},enableReinitialize:!0,validationSchema:Fe,onSubmit:k,children:({setFieldValue:s,handleSubmit:c,errors:a,touched:l})=>e.jsx(U,{className:"row g-3",onSubmit:c,children:e.jsxs(B,{xs:7,children:[e.jsxs(q,{htmlFor:"video",children:["Video ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx(H,{type:"file",accept:"video/*",name:"video",onChange:P=>{const z=P.target.files[0];z&&(s("video",z),T(de=>({...de,video:URL.createObjectURL(z)})))},ref:v}),D.video&&e.jsx(p,{color:"primary",size:"md",type:"button",onClick:()=>ne(D.video),children:"Preview"}),e.jsx(p,{color:"primary",type:"submit",children:"Update"})]}),a.video&&l.video&&e.jsx(O,{className:"text-danger small d-block mt-1",children:a.video})]})})})})]}),e.jsxs("div",{className:"mt-4",children:[m&&e.jsx(Y,{color:"primary",children:m}),w&&e.jsx(Y,{color:"danger",children:w})]}),e.jsx(we,{banners:i,formData:g,handleDelete:re,handleUpdate:k,setActiveForm:r,setShowForm:x})]}),e.jsx(fe,{visible:C,onClose:()=>y(!1),onConfirm:ae,title:"Confirm Delete",message:"Are you sure you want to delete this banner?"}),e.jsxs(K,{visible:te,onClose:()=>_(!1),size:"lg",children:[e.jsx(Q,{closeButton:!0,children:"Video Preview"}),e.jsx(X,{className:"d-flex justify-content-center",children:I&&e.jsxs("video",{width:"100%",controls:!0,autoPlay:!0,children:[e.jsx("source",{src:I,type:"video/mp4"}),"Your browser does not support the video tag."]})})]})]})};export{Ge as default};
