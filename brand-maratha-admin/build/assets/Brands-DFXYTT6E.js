import{j as e,a,C as X}from"./index-f6D6TMGS.js";import{a as S}from"./axios.config-D8NC-S8h.js";import{r as Y,c as Z,ap as ee,aq as se}from"./api.endpoints-D7eIfK11.js";import{M as ae}from"./Modal-Byr5KNe-.js";import{b as re}from"./index.esm-B7prAHhm.js";import{C as R,a as m}from"./CRow-C5aZ3uce.js";import{C as z,a as L}from"./CCardBody-DyHbCEEC.js";import{C as T}from"./CCardHeader-BkEnHaV2.js";import{C as te,a as ne,b as v,c as x,d as ie,e as F}from"./CTable-Bj0B-88c.js";import{C as u}from"./CButton-ByJ5g7iZ.js";import{c as oe}from"./cil-trash-CBbKHhHb.js";import{c as le,a as ce,F as me}from"./formik.esm-DzZc3OM4.js";import{h as I}from"./errorHelper-EbapN-iz.js";import{I as de,a as he}from"./ImagePreview-BEQ8m4jE.js";import{C as xe}from"./CForm-BElthXFv.js";import{C as P,a as k}from"./CFormControlWrapper-aXjT4m4y.js";import{C as A}from"./CFormInput-CzlD-ECf.js";import{C as N}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";import"./index-C7_v8csn.js";const pe=({item:t,handleDelete:g})=>e.jsx(R,{children:e.jsx(m,{xs:12,children:e.jsxs(z,{className:"mb-4",children:[e.jsxs(T,{children:[e.jsx("strong",{children:"Brands"})," ",e.jsx("small",{children:"List"})]}),e.jsx(L,{children:(t==null?void 0:t.length)>0?e.jsxs(te,{hover:!0,children:[e.jsx(ne,{children:e.jsxs(v,{children:[e.jsx(x,{scope:"col",children:"Index"}),e.jsx(x,{scope:"col",children:"Name"}),e.jsx(x,{scope:"col",children:"Image"}),e.jsx(x,{scope:"col",children:"Action"})]})}),e.jsx(ie,{children:t==null?void 0:t.map((r,o)=>e.jsx(a.Fragment,{children:e.jsxs(v,{children:[e.jsx(x,{scope:"row",children:o+1}),e.jsx(F,{children:r.name?r.name:"-"}),e.jsx(F,{children:e.jsx("img",{src:Y+r.image,height:"40px",width:"auto"})}),e.jsx(F,{children:e.jsx(u,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>g(r==null?void 0:r.id),children:e.jsx(re,{icon:oe,size:"md"})})})]})},o))})]}):e.jsx(T,{children:e.jsx("strong",{children:"No brands found!"})})})]})})}),ze=()=>{const[t,g]=a.useState([]),[r,o]=a.useState(""),[j,M]=a.useState(!1),[q,C]=a.useState(!1),[$,B]=a.useState(null),[p,l]=a.useState(""),[H,c]=a.useState(!1),b=a.useRef(null),[O,G]=a.useState(null),[J,D]=a.useState(!1),[V,E]=a.useState(!1),W=le().shape({image:ce().nullable().test("fileRequired","Image is required",function(s){const{existing_image:d}=this.parent;return!d&&!s?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",s=>!s||typeof s!="object"?!0:["image/jpeg","image/png","image/webp"].includes(s.type)).test("fileSize","File size must be less than 5MB",function(s){return!s||typeof s!="object"?!0:s.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})});a.useEffect(()=>{y()},[]),a.useEffect(()=>{if(r||p){const s=setTimeout(()=>{o(""),l("")},3e3);return()=>clearTimeout(s)}},[r,p]);const y=async()=>{c(!0);try{const{data:s}=await S.get(Z);g(s)}catch(s){l(I(s))}finally{c(!1)}};async function K(s,{resetForm:d}){var i;c(!0),o(""),l("");const h=new FormData,f=(i=s.name)==null?void 0:i.trim();f&&h.append("name",f),s.image instanceof File&&h.append("image",s.image);try{const{data:n}=await S.post(ee,h,{headers:{"Content-Type":"multipart/form-data"}});o(n==null?void 0:n.message),y(),b.current&&(b.current.value=""),M(!1),d()}catch(n){l(I(n))}finally{console.log("Form submission completed"),c(!1)}}const Q=s=>{B(s),C(!0)};async function U(){c(!0),l("");try{await S.delete(`${se}/${$}`),y()}catch(s){l(I(s))}finally{C(!1),B(null),c(!1)}}return H?e.jsx(X,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(e.Fragment,{children:e.jsxs(R,{children:[e.jsxs(m,{xs:12,children:[e.jsxs(z,{className:"mb-4",children:[e.jsxs(T,{children:[e.jsx("strong",{children:"Add"})," ",e.jsx("small",{children:"Brands"})]}),e.jsxs(L,{className:"row g-3",children:[e.jsx(m,{xs:12,md:6,children:e.jsx(u,{as:"input",type:"button",color:"primary",value:j!==!0?"Add":"Close",onClick:()=>M(!j)})}),j&&e.jsx(me,{initialValues:{name:"",image:null},validationSchema:W,onSubmit:K,children:({values:s,setFieldValue:d,handleChange:h,handleSubmit:f,errors:i,touched:n})=>e.jsxs(xe,{className:"row g-3 needs-validation",onSubmit:f,children:[e.jsxs(m,{md:6,children:[e.jsx(P,{htmlFor:"name",children:"Title"}),e.jsx(A,{type:"text",name:"name",value:s.name,onChange:h}),i.name&&n.name&&e.jsx(k,{className:"text-danger smalls",children:i.name})]}),e.jsxs(m,{md:6,children:[e.jsxs(P,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(A,{type:"file",accept:"image/*",name:"image",onChange:w=>{const _=w.target.files[0];_&&(G(_),D(!0))},ref:b}),s.image&&e.jsx(u,{color:"primary",size:"md",type:"button",onClick:()=>E(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(de,{show:J,imageFile:O,onClose:()=>D(!1),onCropDone:w=>{d("image",w)}}),e.jsx(he,{visible:V,imageFile:s.image,onClose:()=>E(!1)})]}),i.image&&n.image&&e.jsx(k,{className:"text-danger smalls",children:i.image})]}),e.jsx(m,{xs:12,children:e.jsx(u,{color:"primary",type:"submit",children:"Submit"})}),r&&e.jsx(N,{color:"primary mt-4",children:r})]})})]})]}),e.jsxs("div",{className:"mt-4",children:[r&&e.jsx(N,{color:"primary",children:r}),p&&e.jsx(N,{color:"danger",children:p})]}),e.jsx(pe,{item:t,handleDelete:Q})]}),e.jsx(ae,{visible:q,onClose:()=>C(!1),onConfirm:U,title:"Confirm Delete",message:"Are you sure you want to delete this brands?"})]})})};export{ze as default};
