import{a as s,j as t,C as pe}from"./index-f6D6TMGS.js";import{a as P}from"./axios.config-D8NC-S8h.js";import{b1 as fe,b2 as ge,b3 as he,b4 as be}from"./api.endpoints-D7eIfK11.js";import{M as xe}from"./Modal-Byr5KNe-.js";import{T as je}from"./AboutUsBannerTable-B7G7y3QP.js";import{c as K,a as Q,b as D,F as X}from"./formik.esm-DzZc3OM4.js";import{h as R}from"./errorHelper-EbapN-iz.js";import{I as Y,a as Z}from"./ImagePreview-BEQ8m4jE.js";import{C as ye,a as d}from"./CRow-C5aZ3uce.js";import{C as Ce,a as ee}from"./CCardBody-DyHbCEEC.js";import{C as Se}from"./CCardHeader-BkEnHaV2.js";import{C as h}from"./CButton-ByJ5g7iZ.js";import{C as te}from"./CForm-BElthXFv.js";import{C as b,a as x}from"./CFormControlWrapper-aXjT4m4y.js";import{C as j}from"./CFormInput-CzlD-ECf.js";import{C as ie}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./index.esm-B7prAHhm.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";import"./CTable-Bj0B-88c.js";import"./cil-pen-53d2I-C-.js";import"./cil-trash-CBbKHhHb.js";import"./index-C7_v8csn.js";const He=()=>{const[y,se]=s.useState([]),[C,p]=s.useState(""),[S,w]=s.useState(!1),[B,E]=s.useState(!1),[ae,_]=s.useState(!1),[re,$]=s.useState(null),[a,k]=s.useState({}),g=s.useRef(null),[F,A]=s.useState(""),[ne,n]=s.useState(!1),[N,c]=s.useState(""),[U,q]=s.useState(null),[L,T]=s.useState(!1),[O,I]=s.useState(!1),le=K().shape({title:D().trim().max(255,"Title must be at most 255 characters").test("no-whitespace","Title cannot be only spaces",e=>!e||e.trim()===""?!0:e.trim().length>0),subtitle:D().trim().max(255,"Subtitle must be at most 255 characters").test("no-whitespace","Subtitle cannot be only spaces",e=>!e||e.trim()===""?!0:e.trim().length>0),image:Q().nullable().test("fileRequired","Image is required",function(e){const{existing_image:u}=this.parent;return!u&&!e?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",e=>!e||typeof e!="object"?!0:["image/jpeg","image/png","image/webp"].includes(e.type)).test("fileSize","File size must be less than 5MB",function(e){return!e||typeof e!="object"?!0:e.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})}),oe=K().shape({title:D().nullable().notRequired().test("no-whitespace","Title cannot be empty or only spaces",e=>e==null?!0:e.trim().length>0).max(255,"Title must be at most 255 characters").test("no-whitespace","Title cannot be only spaces",e=>!e||e.trim()===""?!0:e.trim().length>0),subtitle:D().nullable().notRequired().test("no-whitespace","Subtitle cannot be empty or only spaces",e=>e==null?!0:e.trim().length>0).max(255,"Subtitle must be at most 255 characters").test("no-whitespace","Subtitle cannot be only spaces",e=>!e||e.trim()===""?!0:e.trim().length>0),image:Q().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",e=>!e||typeof e!="object"?!0:["image/jpeg","image/png","image/webp"].includes(e.type)).test("fileSize","File size must be less than 5MB",function(e){return!e||typeof e!="object"?!0:e.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})});s.useEffect(()=>{z()},[]),s.useEffect(()=>{a.image&&A(a.image)},[a]),s.useEffect(()=>{if(C||N){const e=setTimeout(()=>{p(""),c("")},3e3);return()=>clearTimeout(e)}},[C,N]);const z=async()=>{n(!0),c("");try{const{data:e}=await P.get(fe);se(e)}catch(e){c(R(e))}finally{n(!1)}};async function me(e,{resetForm:u}){n(!0),p(""),c("");const r={title:e.title.trim(),subtitle:e.subtitle.trim()},l=new FormData;l.append("title",r.title),l.append("subtitle",r.subtitle),l.append("image",e.image);try{const{data:i}=await P.post(ge,l,{headers:{"Content-Type":"multipart/form-data"}});p(i==null?void 0:i.message),g.current&&(g.current.value=""),z(),u(),w(!1)}catch(i){c(R(i))}finally{n(!1)}}const ce=e=>{$(e),_(!0)};async function ue(){n(!0),c("");try{await P.delete(`${be}/${re}`),z(),E(!1)}catch(e){c(R(e))}finally{_(!1),$(null),n(!1)}}async function G(e,{resetForm:u}){var W,v,J,H;if(n(!0),p(""),c(""),!(a!=null&&a.id)){p("Please select a banner first."),n(!1);return}const r={title:((W=e.title)==null?void 0:W.trim())||"",subtitle:((v=e.subtitle)==null?void 0:v.trim())||""},l=((J=a.title)==null?void 0:J.trim())||"",i=((H=a.subtitle)==null?void 0:H.trim())||"";a.image;const o=e.image instanceof File,m=r.title!==l,f=r.subtitle!==i;if(!m&&!f&&!o){p("No changes detected."),n(!1);return}const M=new FormData;M.append("title",r.title),M.append("subtitle",r.subtitle),o&&M.append("image",e.image);try{await P.put(`${he}/${a.id}`,M,{headers:{"Content-Type":"multipart/form-data"}}),p("Banner updated successfully!"),z(),g.current&&(g.current.value=""),k({}),A(""),u(),w(!1)}catch(de){c(R(de))}finally{n(!1)}}const V=()=>{w(!S),E(!1)};return ne?t.jsx(pe,{color:"primary"}):t.jsx(t.Fragment,{children:t.jsxs(ye,{children:[t.jsxs(d,{xs:12,children:[t.jsxs(Ce,{className:"mb-4",children:[t.jsxs(Se,{className:"d-flex justify-content-between align-items-center",children:[t.jsxs("div",{children:[t.jsxs("strong",{children:[" ",B?"Update":"Add"]})," ",t.jsx("small",{children:"banner"})]}),!(y!=null&&y.length)>0?t.jsx(h,{as:"input",type:"button",color:"primary",value:S!==!0?"Add":"Close",onClick:()=>V()}):!B||S&&t.jsx(h,{as:"input",type:"button",color:"primary",value:"Close",onClick:()=>V()})]}),S?B?t.jsx(t.Fragment,{children:t.jsx(X,{initialValues:{title:a.title||"",subtitle:a.subtitle||"",image:a.image||null},enableReinitialize:!0,validationSchema:oe,onSubmit:G,children:({values:e,setFieldValue:u,handleChange:r,handleSubmit:l,errors:i,touched:o})=>t.jsx(ee,{children:t.jsxs(te,{className:"row g-3",onSubmit:l,children:[t.jsxs(d,{md:4,children:[t.jsx(b,{htmlFor:"title",children:"Title"}),t.jsx(j,{type:"text",name:"title",value:e.title,onChange:r}),i.title&&o.title&&t.jsx(x,{className:"text-danger small",children:i.title})]}),t.jsxs(d,{md:4,children:[t.jsx(b,{htmlFor:"subtitle",children:"Sub Title"}),t.jsx(j,{type:"text",name:"subtitle",value:e.subtitle,onChange:r}),i.subtitle&&o.subtitle&&t.jsx(x,{className:"text-danger small",children:i.subtitle})]}),t.jsxs(d,{md:4,children:[t.jsxs(b,{htmlFor:"image",children:["Image",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx(j,{type:"file",accept:"image/*",name:"image",onChange:m=>{const f=m.target.files[0];f&&(q(f),T(!0))},ref:g}),F&&t.jsx(h,{color:"primary",size:"md",type:"button",onClick:()=>I(!0),children:"Preview"})]}),t.jsxs("div",{children:[t.jsx(Y,{show:L,imageFile:U,onClose:()=>T(!1),onCropDone:m=>{u("image",m),A(URL.createObjectURL(m))}}),t.jsx(Z,{visible:O,imageFile:(F.startsWith("blob:"),F),onClose:()=>I(!1)})]}),i.image&&o.image&&t.jsx(x,{className:"text-danger small",children:i.image})]}),t.jsx(d,{xs:12,children:t.jsx(h,{color:"primary",type:"submit",children:"Update"})})]})})})}):t.jsx(ee,{className:"row g-3",children:t.jsx(X,{initialValues:{title:"",subtitle:"",image:null},enableReinitialize:!0,validationSchema:le,onSubmit:me,children:({values:e,setFieldValue:u,handleChange:r,handleSubmit:l,errors:i,touched:o})=>t.jsxs(te,{className:"row g-3",onSubmit:l,children:[t.jsxs(d,{md:4,children:[t.jsx(b,{htmlFor:"title",children:"Title"}),t.jsx(j,{type:"text",name:"title",value:e.title,onChange:r}),i.title&&o.title&&t.jsx(x,{className:"text-danger small",children:i.title})]}),t.jsxs(d,{md:4,children:[t.jsx(b,{htmlFor:"subtitle",children:"Sub Title"}),t.jsx(j,{type:"text",name:"subtitle",value:e.subtitle,onChange:r}),i.subtitle&&o.subtitle&&t.jsx(x,{className:"text-danger small",children:i.subtitle})]}),t.jsxs(d,{md:4,children:[t.jsxs(b,{htmlFor:"image",children:["Image",t.jsx("span",{className:"text-danger",children:"*"})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx(j,{type:"file",accept:"image/*",name:"image",onChange:m=>{const f=m.target.files[0];f&&(q(f),T(!0))},ref:g}),e.image&&t.jsx(h,{color:"primary",size:"md",type:"button",onClick:()=>I(!0),children:"Preview"})]}),t.jsxs("div",{children:[t.jsx(Y,{show:L,imageFile:U,onClose:()=>T(!1),onCropDone:m=>{u("image",m)}}),t.jsx(Z,{visible:O,imageFile:e.image,onClose:()=>I(!1)})]}),i.image&&o.image&&t.jsx(x,{className:"text-danger small",children:i.image})]}),t.jsx(d,{xs:12,children:t.jsx(h,{color:"primary",type:"submit",children:"Submit"})})]})})}):null]}),t.jsxs("div",{className:"mt-4",children:[C&&t.jsx(ie,{color:"primary",children:C}),N&&t.jsx(ie,{color:"danger",children:N})]}),t.jsx(je,{name:"magazine",banners:y,formData:k,handleDelete:ce,handleUpdate:G,setActiveForm:E,setShowForm:w})]}),t.jsx(xe,{visible:ae,onClose:()=>_(!1),onConfirm:ue,title:"Confirm Delete",message:"Are you sure you want to delete this banner?"})]})})};export{He as default};
