import{j as e,a as i,C as Pe}from"./index-f6D6TMGS.js";import{a as B}from"./axios.config-D8NC-S8h.js";import{r as W,a9 as Ne,aa as Me,ab as De,ac as ze,ad as Ie,ae as Ee,af as Re,ag as Te}from"./api.endpoints-D7eIfK11.js";import{c as ne,a as q,b as le,F as oe}from"./formik.esm-DzZc3OM4.js";import{M as ve}from"./Modal-Byr5KNe-.js";import{b as ce}from"./index.esm-B7prAHhm.js";import{C as ge,a as u}from"./CRow-C5aZ3uce.js";import{C as he,a as fe}from"./CCardBody-DyHbCEEC.js";import{C as Y}from"./CCardHeader-BkEnHaV2.js";import{C as ke,a as Be,b as me,c as L,d as qe,e as O}from"./CTable-Bj0B-88c.js";import{C as g}from"./CButton-ByJ5g7iZ.js";import{c as Le}from"./cil-pen-53d2I-C-.js";import{c as Oe}from"./cil-trash-CBbKHhHb.js";import{h as U}from"./errorHelper-EbapN-iz.js";import{I as A,a as G}from"./ImagePreview-BEQ8m4jE.js";import{C as Ue}from"./CFormSelect-BM6fWH_8.js";import{C as de}from"./CForm-BElthXFv.js";import{C as N,a as M}from"./CFormControlWrapper-aXjT4m4y.js";import{C as pe}from"./CFormTextarea-3GaLNVd-.js";import{C as $}from"./CFormInput-CzlD-ECf.js";import{C as ue}from"./CAlert-Ceafrkex.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalHeader-fVen3JA5.js";import"./CModalTitle-AQ6XSAyd.js";import"./index-C7_v8csn.js";const Ae=({mission:l,formData:J,handleDelete:x,setActiveForm:H,setShowForm:S})=>{const y=a=>{J(a),H(!0),S(!0)};return e.jsx(ge,{children:e.jsx(u,{xs:12,children:e.jsxs(he,{className:"mb-4",children:[e.jsxs(Y,{children:[e.jsx("strong",{children:"Mission"})," ",e.jsx("small",{children:"List"})]}),e.jsx(fe,{children:(l==null?void 0:l.length)>0?e.jsxs(ke,{hover:!0,children:[e.jsx(Be,{children:e.jsxs(me,{children:[e.jsx(L,{scope:"col",children:"Description"}),e.jsx(L,{scope:"col",children:"Primary"}),e.jsx(L,{scope:"col",children:"Secondary"}),e.jsx(L,{scope:"col",children:"Action"})]})}),e.jsx(qe,{children:l==null?void 0:l.map((a,P)=>e.jsx(i.Fragment,{children:e.jsxs(me,{children:[e.jsx(O,{style:{width:"35rem"},children:a==null?void 0:a.description}),e.jsx(O,{children:e.jsx("img",{src:W+a.image_primary,height:"40px",width:"auto"})}),e.jsx(O,{children:e.jsx("img",{src:W+a.image_secondary,height:"40px",width:"auto"})}),e.jsxs(O,{width:150,children:[e.jsx(g,{type:"button",color:"success",onClick:()=>y(a),children:e.jsx(ce,{icon:Le,size:"md"})}),e.jsx(g,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>x(a==null?void 0:a.id),children:e.jsx(ce,{icon:Oe,size:"md"})})]})]})},P))})]}):e.jsx(Y,{children:e.jsx("strong",{children:"No mission found!"})})})]})})})},hs=()=>{const[l,J]=i.useState([]),[x,H]=i.useState("english"),[S,y]=i.useState(""),[a,P]=i.useState(!1),[V,K]=i.useState(!1),[h,xe]=i.useState(null),[ye,Q]=i.useState(!1),[je,Z]=i.useState(null),[f,ee]=i.useState(null),[j,D]=i.useState({primary:"",secondary:""}),[z,b]=i.useState(""),[be,C]=i.useState(!1),se=i.useRef(!0),I=i.useRef(null),[E,m]=i.useState(null),[R,d]=i.useState(!1),[_,p]=i.useState(null),[ie,T]=i.useState(!1),[re,v]=i.useState(!1),Ce=ne().shape({description:le().required("Description is required").test("no-whitespace","Cannot be only spaces",s=>s&&s.trim().length>0),image_primary:q().nullable().test("fileRequired","Image is required",function(s){const{existing_image:t}=this.parent;return!t&&!s?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",s=>!s||typeof s!="object"?!0:["image/jpeg","image/png","image/webp"].includes(s.type)).test("fileSize","File size must be less than 5MB",function(s){return!s||typeof s!="object"?!0:s.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0}),image_secondary:q().nullable().test("fileRequired","Image is required",function(s){const{existing_image:t}=this.parent;return!t&&!s?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",s=>!s||typeof s!="object"?!0:["image/jpeg","image/png","image/webp"].includes(s.type)).test("fileSize","File size must be less than 5MB",function(s){return!s||typeof s!="object"?!0:s.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})}),_e=ne().shape({description:le().required("Description is required").test("no-whitespace","Cannot be only spaces",s=>s&&s.trim().length>0),image_primary:q().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",s=>!s||typeof s!="object"?!0:["image/jpeg","image/png","image/webp"].includes(s.type)).test("fileSize","File size must be less than 5MB",function(s){return!s||typeof s!="object"?!0:s.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0}),image_secondary:q().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",s=>!s||typeof s!="object"?!0:["image/jpeg","image/png","image/webp"].includes(s.type)).test("fileSize","File size must be less than 5MB",function(s){return!s||typeof s!="object"?!0:s.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})});i.useEffect(()=>{f&&D({primary:f.image_primary||"",secondary:f.image_secondary||""})},[f]),i.useEffect(()=>{xe({getMission:x==="english"?Re:Te,postMission:x==="english"?Ie:Ee,putMission:x==="english"?De:ze,deleteMission:x==="english"?Ne:Me})},[x]),i.useEffect(()=>{if(se.current){se.current=!1;return}h&&k(h)},[h]),i.useEffect(()=>{if(S||z){const s=setTimeout(()=>{y(""),b("")},3e3);return()=>clearTimeout(s)}},[S,z]);const k=async s=>{C(!0),b("");try{const{data:t}=await B.get(s.getMission);J(t)}catch(t){b(U(t))}finally{C(!1)}};async function we(s,{resetForm:t}){C(!0),y(""),b("");const w={description:s.description.trim()},o=new FormData;o.append("description",w.description),o.append("image_primary",s.image_primary),o.append("image_secondary",s.image_secondary);try{const{data:r}=await B.post(h.postMission,o,{headers:{"Content-Type":"multipart/form-data"}});y("Record created successfully!"),k(h),I.current&&(I.current.value=""),P(!1),t()}catch(r){b(U(r))}finally{C(!1)}}const Fe=s=>{Z(s),Q(!0)};async function Se(){C(!0);try{await B.delete(`${h.deleteMission}/${je}`),k(h),K(!1)}catch(s){b(U(s))}finally{Q(!1),Z(null),C(!1)}}async function ae(s,{resetForm:t}){if(C(!0),y(""),b(""),f.id===null){y("Please select a banner first.");return}const w={description:s.description.trim()},o=new FormData;o.append("description",w.description),s.image_primary instanceof File&&o.append("image_primary",s.image_primary),s.image_secondary instanceof File&&o.append("image_secondary",s.image_secondary);try{await B.put(`${h.putMission}/${f.id}`,o,{headers:{"Content-Type":"multipart/form-data"}}),y("Record updated successfully!"),k(h),I.current&&(I.current.value=""),ee({}),D(""),t(),P(!1)}catch(r){b(U(r))}finally{C(!1)}}const te=()=>{P(!a),K(!1)};return be?e.jsx(Pe,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(e.Fragment,{children:e.jsxs(ge,{children:[e.jsxs(u,{xs:12,children:[e.jsxs(he,{className:"mb-4",children:[e.jsxs(Y,{children:[e.jsxs("strong",{children:[" ",V?"Update":"Add"]})," ",e.jsx("small",{children:"our mission"})]}),e.jsxs(fe,{className:"row g-3",children:[e.jsx(u,{xs:12,md:4,lg:2,children:e.jsxs(Ue,{"aria-label":"Default select example",value:x,onChange:s=>H(s.target.value),disabled:a,children:[e.jsx("option",{value:"english",children:"English"}),e.jsx("option",{value:"marathi",children:"मराठी"})]})}),e.jsx(u,{xs:12,md:6,children:!(l!=null&&l.length)>0?e.jsx(g,{as:"input",type:"button",color:"primary",value:a!==!0?"Add":"Close",onClick:()=>te()}):!V||a&&e.jsx(g,{as:"input",type:"button",color:"primary",value:"Close",onClick:()=>te()})}),a?V?e.jsx(e.Fragment,{children:e.jsx(oe,{initialValues:{description:f.description||"",image_primary:f.image_primary||null,image_secondary:f.image_secondary||null},enableReinitialize:!0,validationSchema:_e,onSubmit:ae,children:({values:s,setFieldValue:t,handleChange:w,handleSubmit:o,errors:r,touched:F})=>e.jsxs(de,{className:"row g-3 needs-validation",onSubmit:o,children:[e.jsxs(u,{md:12,children:[e.jsxs(N,{htmlFor:"description",children:["Description",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(pe,{type:"text",name:"description",value:s.description,onChange:w}),r.description&&F.description&&e.jsx(M,{className:"text-danger small",children:r.description})]}),e.jsxs(u,{md:6,children:[e.jsxs(N,{htmlFor:"image_primary",children:["Primary Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx($,{type:"file",accept:"image/*",name:"image_primary",onChange:n=>{const c=n.target.files[0];c&&(m(c),p("image_primary"),D(X=>({...X,primary:URL.createObjectURL(c)})),d(!0))}}),j.primary&&e.jsx(g,{color:"primary",size:"md",type:"button",onClick:()=>T(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(A,{show:R,imageFile:E,onClose:()=>{d(!1),m(null),p(null)},onCropDone:n=>{_&&t(_,n),d(!1),m(null),p(null)}}),e.jsx(G,{visible:ie,imageFile:j.primary.startsWith("blob:")?j.primary:W+j.primary,onClose:()=>T(!1)})]}),r.image_primary&&F.image_primary&&e.jsx(M,{className:"text-danger small",children:r.image_primary})]}),e.jsxs(u,{md:6,children:[e.jsxs(N,{htmlFor:"image_secondary",children:["Secondary Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx($,{type:"file",accept:"image/*",name:"image_secondary",onChange:n=>{const c=n.target.files[0];c&&(m(c),p("image_secondary"),D(X=>({...X,secondary:URL.createObjectURL(c)})),d(!0))}}),j.secondary&&e.jsx(g,{color:"primary",size:"md",type:"button",onClick:()=>v(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(A,{show:R,imageFile:E,onClose:()=>{d(!1),m(null),p(null)},onCropDone:n=>{_&&t(_,n),d(!1),m(null),p(null)}}),e.jsx(G,{visible:re,imageFile:j.secondary.startsWith("blob:")?j.secondary:W+j.secondary,onClose:()=>v(!1)})]}),r.image_secondary&&F.image_secondary&&e.jsx(M,{className:"text-danger small",children:r.image_secondary})]}),e.jsx(u,{xs:12,children:e.jsx(g,{color:"primary",type:"submit",children:"Update"})})]})})}):!(l!=null&&l.length)>0&&e.jsx(oe,{initialValues:{description:"",image_primary:null,image_secondary:null},enableReinitialize:!0,validationSchema:Ce,onSubmit:we,children:({values:s,setFieldValue:t,handleChange:w,handleSubmit:o,errors:r,touched:F})=>e.jsxs(de,{className:"row g-3 needs-validation",onSubmit:o,children:[e.jsxs(u,{md:12,children:[e.jsxs(N,{htmlFor:"description",children:["Description",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(pe,{type:"text",name:"description",value:s.description,onChange:w}),r.description&&F.description&&e.jsx(M,{className:"text-danger small",children:r.description})]}),e.jsxs(u,{md:6,children:[e.jsxs(N,{htmlFor:"image_primary",children:["Primary Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx($,{type:"file",accept:"image/*",name:"image_primary",onChange:n=>{const c=n.target.files[0];c&&(m(c),p("image_primary"),d(!0))}}),s.image_primary&&e.jsx(g,{color:"primary",size:"md",type:"button",onClick:()=>T(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(A,{show:R,imageFile:E,onClose:()=>{d(!1),m(null),p(null)},onCropDone:n=>{_&&t(_,n),d(!1),m(null),p(null)}}),e.jsx(G,{visible:ie,imageFile:s.image_primary,onClose:()=>T(!1)})]}),r.image_primary&&F.image_primary&&e.jsx(M,{className:"text-danger small",children:r.image_primary})]}),e.jsxs(u,{md:6,children:[e.jsxs(N,{htmlFor:"image_secondary",children:["Secondary Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx($,{type:"file",accept:"image/*",name:"image_secondary",onChange:n=>{const c=n.target.files[0];c&&(m(c),p("image_secondary"),d(!0))}}),s.image_secondary&&e.jsx(g,{color:"primary",size:"md",type:"button",onClick:()=>v(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(A,{show:R,imageFile:E,onClose:()=>{d(!1),m(null),p(null)},onCropDone:n=>{_&&t(_,n),d(!1),m(null),p(null)}}),e.jsx(G,{visible:re,imageFile:s.image_secondary,onClose:()=>v(!1)})]}),r.image_secondary&&F.image_secondary&&e.jsx(M,{className:"text-danger small",children:r.image_secondary})]}),e.jsx(u,{xs:12,children:e.jsx(g,{color:"primary",type:"submit",children:"Submit"})})]})}):null]})]}),e.jsxs("div",{className:"mt-4",children:[S&&e.jsx(ue,{color:"primary",children:S}),z&&e.jsx(ue,{color:"danger",children:z})]}),e.jsx(Ae,{mission:l,formData:ee,handleDelete:Fe,handleUpdate:ae,setActiveForm:K,setShowForm:P})]}),e.jsx(ve,{visible:ye,onClose:()=>Q(!1),onConfirm:Se,title:"Confirm Delete",message:"Are you sure you want to delete this our mission?"})]})})};export{hs as default};
