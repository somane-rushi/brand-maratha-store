import{j as e,a as n,C as Ce}from"./index-f6D6TMGS.js";import{b as Q}from"./index.esm-B7prAHhm.js";import{r as le,s as ye,t as _e,u as ke,v as Fe,w as Se,x as we,y as Be,z as Ne}from"./api.endpoints-D7eIfK11.js";import{C as re,a as c}from"./CRow-C5aZ3uce.js";import{C as oe,a as ce}from"./CCardBody-DyHbCEEC.js";import{C as $}from"./CCardHeader-BkEnHaV2.js";import{C as Ie,a as Te,b as X,c as y,d as ve,e as I}from"./CTable-Bj0B-88c.js";import{C as _}from"./CButton-ByJ5g7iZ.js";import{c as De}from"./cil-pen-53d2I-C-.js";import{c as Ee}from"./cil-trash-CBbKHhHb.js";import{a as R}from"./axios.config-D8NC-S8h.js";import{c as Y,a as Z,b as ee,F as te}from"./formik.esm-DzZc3OM4.js";import{M as Pe}from"./Modal-Byr5KNe-.js";import{h as z}from"./errorHelper-EbapN-iz.js";import{I as se,a as ne}from"./ImagePreview-BEQ8m4jE.js";import{C as Re}from"./CFormSelect-BM6fWH_8.js";import{C as ae}from"./CForm-BElthXFv.js";import{C as f,a as g}from"./CFormControlWrapper-aXjT4m4y.js";import{C as j}from"./CFormInput-CzlD-ECf.js";import{C as ie}from"./CAlert-Ceafrkex.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalHeader-fVen3JA5.js";import"./CModalTitle-AQ6XSAyd.js";import"./index-C7_v8csn.js";const ze=({banners:i,formData:M,handleDelete:x,setActiveForm:L,setShowForm:k})=>{const b=s=>{M(s),L(!0),k(!0)};return e.jsx(re,{children:e.jsx(c,{xs:12,children:e.jsxs(oe,{className:"mb-4",children:[e.jsxs($,{children:[e.jsx("strong",{children:"Banner"})," ",e.jsx("small",{children:"List"})]}),e.jsx(ce,{children:(i==null?void 0:i.length)>0?e.jsxs(Ie,{hover:!0,children:[e.jsx(Te,{children:e.jsxs(X,{children:[e.jsx(y,{scope:"col",children:"Index"}),e.jsx(y,{scope:"col",children:"Title"}),e.jsx(y,{scope:"col",children:"Sub Title"}),e.jsx(y,{scope:"col",children:"Link"}),e.jsx(y,{scope:"col",children:"Image"}),e.jsx(y,{scope:"col",children:"Action"})]})}),e.jsx(ve,{children:i==null?void 0:i.map((s,F)=>e.jsx(n.Fragment,{children:e.jsxs(X,{children:[e.jsx(y,{scope:"row",children:F+1}),e.jsx(I,{children:s!=null&&s.title?s==null?void 0:s.title:"-"}),e.jsx(I,{children:s!=null&&s.subtitle?s==null?void 0:s.subtitle:"-"}),e.jsx(I,{children:s!=null&&s.link?s==null?void 0:s.link:"-"}),e.jsx(I,{children:e.jsx("img",{src:le+s.banner_image,height:"40px",width:"auto"})}),e.jsxs(I,{width:150,children:[e.jsx(_,{type:"button",color:"success",onClick:()=>b(s),children:e.jsx(Q,{icon:De,size:"md"})}),e.jsx(_,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>x(s==null?void 0:s.id),children:e.jsx(Q,{icon:Ee,size:"md"})})]})]})},F))})]}):e.jsx($,{children:e.jsx("strong",{children:"No banner found!"})})})]})})})},ot=()=>{const[i,M]=n.useState([]),[x,L]=n.useState("english"),[k,b]=n.useState(!1),[s,F]=n.useState(!1),[m,me]=n.useState(null),[de,U]=n.useState(!1),[ue,O]=n.useState(null),[C,G]=n.useState({}),H=n.useRef(!0),S=n.useRef(null),[w,A]=n.useState(null),[he,d]=n.useState(!1),[T,B]=n.useState(""),[v,u]=n.useState(""),[q,V]=n.useState(null),[W,D]=n.useState(!1),[J,E]=n.useState(!1),xe=Y().shape({link:ee().url("Invalid URL format"),banner_image:Z().nullable().test("fileRequired","Image is required",function(t){const{existing_image:l}=this.parent;return!l&&!t?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>12*1024*1024?this.createError({message:"File exceeds 12MB limit"}):!0})}),pe=Y().shape({link:ee().url("Invalid URL format"),banner_image:Z().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>12*1024*1024?this.createError({message:"File exceeds 12MB limit"}):!0})});n.useEffect(()=>{me({getBanner:x==="english"?Be:Ne,postBanner:x==="english"?Se:we,putBanner:x==="english"?ke:Fe,deleteBanner:x==="english"?ye:_e})},[x]),n.useEffect(()=>{if(H.current){H.current=!1;return}m&&P(m)},[m]),n.useEffect(()=>{if(T||v){const t=setTimeout(()=>{B(""),u("")},3e3);return()=>clearTimeout(t)}},[T,v]),n.useEffect(()=>{A(C.banner_image||"")},[C.banner_image]);const P=async t=>{d(!0),u("");try{const l=await R.get(t.getBanner);M(l==null?void 0:l.data)}catch(l){u(z(l))}finally{d(!1)}};async function fe(t,{resetForm:l}){u(""),B(""),d(!0);const r={title:t.title.trim(),subtitle:t.subtitle.trim(),link:t.link.trim()},o=new FormData;o.append("title",r.title),o.append("subtitle",r.subtitle),o.append("link",r.link),o.append("banner_image",t.banner_image);try{await R.post(m.postBanner,o,{headers:{"Content-Type":"multipart/form-data"}}),B("Banner created successfully!"),P(m),S.current&&(S.current.value=""),(i==null?void 0:i.length)<7&&b(!1),b(!1),l()}catch(a){u(z(a))}finally{d(!1)}}async function K(t,{resetForm:l}){if(u(""),B(""),d(!0),C.id===null){B("Please select a banner first.");return}const r={title:t.title.trim(),subtitle:t.subtitle.trim(),link:t.link.trim()},o=new FormData;o.append("title",r.title),o.append("subtitle",r.subtitle),o.append("link",r.link),o.append("banner_image",t.banner_image),d(!0);try{await R.put(`${m.putBanner}/${C.id}`,o,{headers:{"Content-Type":"multipart/form-data"}}),B("Banner updated successfully!"),P(m),S.current&&(S.current.value=""),G({}),A(""),l(),b(!1)}catch(a){u(z(a))}finally{d(!1)}}const ge=()=>{b(!k),F(!1)},je=t=>{O(t),U(!0)};async function be(){u(""),d(!0);try{await R.delete(`${m.deleteBanner}/${ue}`),P(m),F(!1)}catch(t){u(z(t))}finally{U(!1),O(null),d(!1)}}return he?e.jsx(Ce,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(e.Fragment,{children:e.jsxs(re,{children:[e.jsxs(c,{xs:12,children:[e.jsxs(oe,{className:"mb-4",children:[e.jsxs($,{children:[e.jsxs("strong",{children:[" ",s?"Update":"Add"]})," ",e.jsx("small",{children:"Banner"})]}),e.jsxs(ce,{className:"row g-3",children:[e.jsx(c,{xs:12,md:4,lg:2,children:e.jsxs(Re,{"aria-label":"Default select example",value:x,onChange:t=>L(t.target.value),disabled:k,children:[e.jsx("option",{value:"english",children:"English"}),e.jsx("option",{value:"marathi",children:"मराठी"})]})}),(i==null?void 0:i.length)<7&&e.jsx(c,{xs:12,md:6,lg:!0,children:e.jsx(_,{as:"input",type:"button",color:"primary",value:k?"Close":"Add",onClick:ge})}),k?!s&&(i==null?void 0:i.length)<7?e.jsx(te,{initialValues:{title:"",subtitle:"",link:"",banner_image:null},enableReinitialize:!0,validationSchema:xe,onSubmit:fe,children:({values:t,setFieldValue:l,handleChange:r,handleSubmit:o,errors:a,touched:h})=>e.jsxs(ae,{className:"row g-3 needs-validation",onSubmit:o,children:[e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"title",children:"Title"}),e.jsx(j,{type:"text",name:"title",value:t.title,onChange:r}),a.title&&h.title&&e.jsx(g,{className:"text-danger small",children:a.title})]}),e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"subtitle",children:"Sub Title"}),e.jsx(j,{type:"text",name:"subtitle",value:t.subtitle,onChange:r}),a.subtitle&&h.subtitle&&e.jsx(g,{className:"text-danger small",children:a.subtitle})]}),e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"link",children:"Link"}),e.jsx(j,{type:"text",name:"link",value:t.link,onChange:r}),a.link&&h.link&&e.jsx(g,{className:"text-danger small",children:a.link})]}),e.jsxs(c,{md:6,children:[e.jsxs(f,{htmlFor:"banner_image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(j,{type:"file",accept:"image/*",name:"banner_image",onChange:p=>{const N=p.target.files[0];N&&(V(N),D(!0))},ref:S}),t.banner_image&&e.jsx(_,{color:"primary",size:"md",type:"button",onClick:()=>E(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(se,{show:W,imageFile:q,onClose:()=>D(!1),onCropDone:p=>{l("banner_image",p)}}),e.jsx(ne,{visible:J,imageFile:t.banner_image,onClose:()=>E(!1)})]}),a.banner_image&&h.banner_image&&e.jsx(g,{className:"text-danger small",children:a.banner_image})]}),e.jsx(c,{xs:12,children:e.jsx(_,{color:"primary",type:"submit",children:"Submit"})})]})}):e.jsx(te,{initialValues:{title:C.title||"",subtitle:C.subtitle||"",link:C.link||"",banner_image:null},enableReinitialize:!0,validationSchema:pe,onSubmit:K,children:({values:t,setFieldValue:l,handleChange:r,handleSubmit:o,errors:a,touched:h})=>e.jsxs(ae,{className:"row g-3 needs-validation",onSubmit:o,children:[e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"title",children:"Title"}),e.jsx(j,{type:"text",name:"title",value:t.title,onChange:r}),a.title&&h.title&&e.jsx(g,{className:"text-danger small",children:a.title})]}),e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"subtitle",children:"Sub Title"}),e.jsx(j,{type:"text",name:"subtitle",value:t.subtitle,onChange:r}),a.subtitle&&h.subtitle&&e.jsx(g,{className:"text-danger small",children:a.subtitle})]}),e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"link",children:"Link"}),e.jsx(j,{type:"text",name:"link",value:t.link,onChange:r}),a.link&&h.link&&e.jsx(g,{className:"text-danger small",children:a.link})]}),e.jsxs(c,{md:6,children:[e.jsxs(f,{htmlFor:"banner_image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(j,{type:"file",accept:"image/*",name:"banner_image",onChange:p=>{const N=p.target.files[0];N&&(V(N),D(!0))},ref:S}),w&&e.jsx(_,{color:"primary",size:"md",type:"button",onClick:()=>E(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(se,{show:W,imageFile:q,onClose:()=>D(!1),onCropDone:p=>{l("banner_image",p),A(URL.createObjectURL(p))}}),e.jsx(ne,{visible:J,imageFile:w!=null&&w.startsWith("blob:")?w:le+w,onClose:()=>E(!1)})]}),a.banner_image&&h.banner_image&&e.jsx(g,{className:"text-danger small",children:a.banner_image})]}),e.jsx(c,{xs:12,children:e.jsx(_,{color:"primary",type:"submit",children:"Update"})})]})}):null]})]}),e.jsxs("div",{className:"mt-4",children:[T&&e.jsx(ie,{color:"primary",children:T}),v&&e.jsx(ie,{color:"danger",children:v})]}),e.jsx(ze,{banners:i,formData:G,handleDelete:je,handleUpdate:K,setActiveForm:F,setShowForm:b})]}),e.jsx(Pe,{visible:de,onClose:()=>U(!1),onConfirm:be,title:"Confirm Delete",message:"Are you sure you want to delete this banner?"})]})})};export{ot as default};
