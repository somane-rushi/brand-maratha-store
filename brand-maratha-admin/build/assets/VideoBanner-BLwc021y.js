import{a as r,j as e,C as Te}from"./index-f6D6TMGS.js";import{a as q}from"./axios.config-D8NC-S8h.js";import{T as Ne,b5 as Me,b6 as Ve,b7 as Re,b8 as Pe}from"./api.endpoints-D7eIfK11.js";import{M as Be}from"./Modal-Byr5KNe-.js";import{b as H}from"./index.esm-B7prAHhm.js";import{C as pe,a as m}from"./CRow-C5aZ3uce.js";import{C as xe,a as Z}from"./CCardBody-DyHbCEEC.js";import{C as K}from"./CCardHeader-BkEnHaV2.js";import{C as ze,a as Ie,b as le,c as P,d as De,e as I}from"./CTable-Bj0B-88c.js";import{C as b}from"./CButton-ByJ5g7iZ.js";import{c as Ee}from"./DefaultLayout-BE9qYLzL.js";import{c as Le}from"./cil-pen-53d2I-C-.js";import{c as _e}from"./cil-trash-CBbKHhHb.js";import{C as fe,a as je,b as be}from"./CModalHeader-fVen3JA5.js";import{F as de,c as ge,a as O,b as W}from"./formik.esm-DzZc3OM4.js";import{h as Y}from"./errorHelper-EbapN-iz.js";import{I as ce,a as ue}from"./ImagePreview-BEQ8m4jE.js";import{C as me}from"./CForm-BElthXFv.js";import{C as j,a as C}from"./CFormControlWrapper-aXjT4m4y.js";import{C as y}from"./CFormInput-CzlD-ECf.js";import{C as he}from"./CFormSelect-BM6fWH_8.js";import{C as J}from"./CAlert-Ceafrkex.js";import"./CModalTitle-AQ6XSAyd.js";import"./cil-user-Ddrdy7PS.js";import"./index-C7_v8csn.js";var Ue={};const Ae=({banners:t,formData:M,handleDelete:x,setActiveForm:f,setShowForm:d})=>{const[V,R]=r.useState(!1),[h,D]=r.useState(""),B=s=>{M(s),f(!0),d(!0)},G=s=>{D(s),R(!0)},E=()=>{R(!1),D("")};return e.jsxs(pe,{children:[e.jsx(m,{xs:12,children:e.jsxs(xe,{className:"mb-4",children:[e.jsxs(K,{children:[e.jsx("strong",{children:"Banner"})," ",e.jsx("small",{children:"List"})]}),e.jsx(Z,{children:(t==null?void 0:t.length)>0?e.jsxs(ze,{hover:!0,children:[e.jsx(Ie,{children:e.jsxs(le,{children:[e.jsx(P,{scope:"col",children:"Index"}),e.jsx(P,{scope:"col",children:"Title"}),e.jsx(P,{scope:"col",children:"Duration"}),e.jsx(P,{scope:"col",children:"Thumbnail"}),e.jsx(P,{scope:"col",children:"Video"}),e.jsx(P,{scope:"col",children:"Action"})]})}),e.jsx(De,{children:t==null?void 0:t.map((s,z)=>e.jsx(r.Fragment,{children:e.jsxs(le,{children:[e.jsx(P,{scope:"row",children:z+1}),e.jsx(I,{children:(s==null?void 0:s.title)||"-"}),e.jsx(I,{children:(s==null?void 0:s.duration)||"-"}),e.jsx(I,{children:e.jsx("img",{src:/^https?:\/\//.test(s.thumbnail)?s.thumbnail:Ne+s.thumbnail,height:"40px",width:"auto",alt:"Banner"})}),e.jsx(I,{children:s.video?e.jsxs(b,{color:"primary",size:"sm",onClick:()=>G(s.video),children:[e.jsx(H,{icon:Ee,size:"sm"})," Play Video"]}):"No Video Available"}),e.jsxs(I,{children:[e.jsx(b,{type:"button",color:"success",onClick:()=>B(s),children:e.jsx(H,{icon:Le,size:"md"})}),e.jsx(b,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>x(s==null?void 0:s.id),children:e.jsx(H,{icon:_e,size:"md"})})]})]})},z))})]}):e.jsx(K,{children:e.jsx("strong",{children:"No banner found!"})})})]})}),e.jsxs(fe,{visible:V,onClose:E,size:"lg",children:[e.jsx(je,{closeButton:!0,children:"Video Preview"}),e.jsx(be,{className:"d-flex justify-content-center",children:h?/youtu\.?be|youtube\.com/.test(h)?e.jsx("iframe",{width:"100%",height:"400",src:h.includes("youtube.com/watch")?h.replace("watch?v=","embed/").split("&")[0]:h.includes("youtu.be/")?`https://www.youtube.com/embed/${h.split("youtu.be/")[1].split("?")[0]}`:"",title:"YouTube Video",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):e.jsxs("video",{width:"100%",height:"400",controls:!0,autoPlay:!0,children:[e.jsx("source",{src:h.startsWith("http")?h:`${Ue.REACT_APP_BASE_URL||""}/${h}`,type:"video/mp4"}),"Your browser does not support the video tag."]}):e.jsx("p",{children:"No Video Available"})})]})]})},$e=ge().shape({title:W().trim().max(255,"Title must be at most 255 characters").test("no-whitespace","Title cannot be only spaces",t=>!t||t.trim()===""?!0:t.trim().length>0),duration:W().nullable().notRequired().test("no-whitespace","Duration cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).matches(/^\d{1,2}:\d{2}$/,"Duration must be in MM:SS format"),thumbnail:O().nullable().test("fileRequired","Image is required",function(t){const{existing_image:M}=this.parent;return!M&&!t?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0}),video:O().required("Video is required").test("is-valid-video-or-url","Invalid video input",function(t){const x=typeof window<"u"&&t instanceof File,f=typeof t=="string";return x?["video/mp4","video/quicktime","video/x-msvideo"].includes(t.type)?t.size>20*1024*1024?this.createError({message:"File exceeds 20MB limit"}):!0:this.createError({message:"Only MP4, MOV, AVI formats are allowed"}):f?/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(t.trim())?!0:this.createError({message:"Enter a valid YouTube URL"}):this.createError({message:"Invalid input: must be a YouTube URL or video file"})})}),ke=ge().shape({title:W().nullable().notRequired().test("no-whitespace","Title cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Title must be at most 255 characters"),duration:W().nullable().notRequired().test("no-whitespace","Duration cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).matches(/^\d{1,2}:\d{2}$/,"Duration must be in MM:SS format"),thumbnail:O().nullable().notRequired().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0}),video:O().required("Video is required").test("is-valid-video-or-url","Enter a valid YouTube URL or upload a video file",function(t){if(!t)return!1;const x=typeof window<"u"&&t instanceof File,f=typeof t=="string";if(x)return["video/mp4","video/quicktime","video/x-msvideo"].includes(t.type)?t.size>20*1024*1024?this.createError({message:"File exceeds 20MB limit"}):!0:this.createError({message:"Only MP4, MOV, AVI formats are allowed"});if(f){const d=t.trim();return!!(d.startsWith("/uploads/")||d.startsWith("uploads/")||d.includes("://")&&d.includes("/uploads/")||/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+$/.test(d))}return!1})}),pt=()=>{var ae;const[t,M]=r.useState([]),[x,f]=r.useState(""),[d,V]=r.useState(!1),[R,h]=r.useState(!1),[D,B]=r.useState(!1),[G,E]=r.useState(null),[s,z]=r.useState({}),g=r.useRef(null),[ye,F]=r.useState(!1),[L,v]=r.useState(""),[Q,X]=r.useState(null),[ee,_]=r.useState(!1),[te,U]=r.useState(!1),[w,A]=r.useState((ae=s.video)!=null&&ae.startsWith("http")?"url":"file"),[ve,ie]=r.useState(!1),[$,we]=r.useState(""),[S,T]=r.useState({image:s.thumbnail||"",video:s.video||""});r.useEffect(()=>{k()},[]),r.useEffect(()=>{if(x||L){const i=setTimeout(()=>{f(""),v("")},3e3);return()=>clearTimeout(i)}},[x,L]),r.useEffect(()=>{const{thumbnail:i,video:c}=s;(i||c)&&T({image:i,video:c})},[s]),r.useEffect(()=>{s.video&&typeof s.video=="string"&&s.video.includes("youtu")?(A("url"),T(i=>({...i,video:s.video}))):s.video&&(A("file"),T(i=>({...i,video:s.video})))},[s]);const k=async()=>{F(!0),v("");try{const{data:i}=await q.get(Me);M(i)}catch(i){v(Y(i))}finally{F(!1)}};async function Ce(i,{resetForm:c}){F(!0),v(""),f("");const p={title:i.title.trim(),duration:i.duration.trim()},a=new FormData;a.append("title",p.title),a.append("duration",p.duration),i.thumbnail&&a.append("thumbnail",i.thumbnail),(typeof i.video=="string"||i.video instanceof File)&&a.append("video",i.video);try{const{data:n}=await q.post(Ve,a,{headers:{"Content-Type":"multipart/form-data"}});f(n==null?void 0:n.message),k(),g.current&&(g.current.value=""),V(!d)}catch(n){v(Y(n))}finally{F(!1)}}const Fe=i=>{E(i),B(!0)};async function Se(){F(!0),v("");try{await q.delete(`${Pe}/${G}`),k(),h(!1)}catch(i){v(Y(i))}finally{B(!1),E(null),F(!1)}}async function se(i,{resetForm:c}){if(F(!0),f(""),v(""),s.id===null){f("Please select a banner first.");return}const p={title:i.title.trim(),duration:i.duration.trim()},a=new FormData;a.append("title",p.title),a.append("duration",p.duration),i.thumbnail instanceof File&&a.append("thumbnail",i.thumbnail),w==="file"&&i.video instanceof File?a.append("video",i.video):w==="url"&&typeof i.video=="string"&&a.append("video",i.video.trim());try{await q.put(`${Re}/${s.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}),f("Banner updated successfully!"),k(),g.current&&(g.current.value=""),z({}),T({image:"",video:""}),V(!1),c()}catch(n){v(Y(n))}finally{F(!1)}}const re=()=>{V(!d),h(!1)},oe=i=>{we(i),ie(!0)},ne=i=>{const c=i.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return c?c[1]:""};return ye?e.jsx(Te,{color:"primary"}):e.jsx(e.Fragment,{children:e.jsxs(pe,{children:[e.jsxs(m,{xs:12,children:[e.jsxs(xe,{className:"mb-4",children:[e.jsxs(K,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[" ",R?"Update":"Add"]})," ",e.jsx("small",{children:"banner"})]}),(t==null?void 0:t.length)<2?e.jsx(b,{as:"input",type:"button",color:"primary",value:d!==!0?"Add":"Close",onClick:()=>re()}):!R||d&&e.jsx(b,{as:"input",type:"button",color:"primary",value:"Close",onClick:()=>re()})]}),d?R?e.jsx(e.Fragment,{children:e.jsx(Z,{children:e.jsx(de,{initialValues:{title:s.title||"",duration:s.duration||"",thumbnail:s.thumbnail||null,video:s.video||null},enableReinitialize:!0,validationSchema:ke,onSubmit:se,children:({values:i,setFieldValue:c,handleChange:p,handleSubmit:a,errors:n,touched:u})=>e.jsxs(me,{className:"row g-3 needs-validation",onSubmit:a,children:[e.jsxs(m,{md:5,children:[e.jsx(j,{htmlFor:"title",children:"Title"}),e.jsx(y,{type:"text",id:"validationCustom01",name:"title",value:i.title,onChange:p}),n.title&&u.title&&e.jsx(C,{className:"text-danger small",children:n.title})]}),e.jsxs(m,{md:2,children:[e.jsx(j,{htmlFor:"duration",children:"Duration"}),e.jsx(y,{type:"text",name:"duration",value:i.duration,onChange:p}),n.duration&&u.duration&&e.jsx(C,{className:"text-danger small",children:n.duration})]}),e.jsxs(m,{md:5,children:[e.jsxs(j,{htmlFor:"thumbnail",children:["Thumbnail",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(y,{type:"file",accept:"image/*",name:"thumbnail",onChange:l=>{const o=l.target.files[0];o&&(X(o),_(!0))},ref:g}),S.image&&e.jsx(b,{color:"primary",size:"md",type:"button",onClick:()=>U(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(ce,{show:ee,imageFile:Q,onClose:()=>_(!1),onCropDone:l=>{c("thumbnail",l),T(o=>({...o,image:URL.createObjectURL(l)}))}}),e.jsx(ue,{visible:te,imageFile:(S.image.startsWith("blob:"),S.image),onClose:()=>U(!1)})]}),n.thumbnail&&u.thumbnail&&e.jsx(C,{className:"text-danger small",children:n.thumbnail})]}),e.jsxs(m,{md:2,children:[e.jsx(j,{htmlFor:"video",children:"Video Type"}),e.jsxs(he,{className:"mb-2",value:w,onChange:l=>{const o=l.target.value;A(o),T(N=>({...N,video:""})),c("video","")},children:[e.jsx("option",{value:"file",children:"Video File"}),e.jsx("option",{value:"url",children:"YouTube URL"})]})]}),e.jsxs(m,{xs:5,children:[w==="file"&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{htmlFor:"video",children:["Video ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(y,{type:"file",accept:"video/*",name:"video",onChange:l=>{const o=l.target.files[0];o&&(c("video",o),T(N=>({...N,video:URL.createObjectURL(o)})))},ref:g}),S.video&&e.jsx(b,{color:"primary",size:"md",type:"button",onClick:()=>oe(S.video),children:"Preview"})]})]}),w==="url"&&e.jsxs(e.Fragment,{children:[e.jsxs(j,{htmlFor:"video",children:["Video ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(y,{type:"url",name:"video",placeholder:"https://www.youtube.com/watch?v=...",value:i.video,onChange:l=>{p(l),T(o=>({...o,video:l.target.value}))}}),S.video&&e.jsx(b,{color:"primary",size:"md",type:"button",onClick:()=>oe(S.video),children:"Preview"})]})]}),e.jsxs(fe,{visible:ve,onClose:()=>ie(!1),size:"lg",children:[e.jsx(je,{closeButton:!0,children:"Video Preview"}),e.jsx(be,{className:"d-flex justify-content-center",children:$&&(w==="file"?e.jsxs("video",{width:"100%",controls:!0,autoPlay:!0,children:[e.jsx("source",{src:$,type:"video/mp4"}),"Your browser does not support the video tag."]}):ne($)?e.jsx("iframe",{width:"100%",height:"400",src:`https://www.youtube.com/embed/${ne($)}`,title:"YouTube video preview",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):e.jsx("p",{className:"text-danger",children:"Invalid YouTube URL"}))})]}),n.video&&u.video&&e.jsx(C,{className:"text-danger small",children:n.video})]}),e.jsx(m,{xs:12,children:e.jsx(b,{color:"primary",type:"submit",children:"Update"})}),x&&e.jsx(J,{color:"primary mt-4",children:x})]})})})}):(t==null?void 0:t.length)<2&&e.jsx(Z,{className:"row g-3",children:e.jsx(de,{initialValues:{title:"",duration:"",thumbnail:null,video:null},enableReinitialize:!0,validationSchema:$e,onSubmit:Ce,children:({values:i,setFieldValue:c,handleChange:p,handleSubmit:a,handleBlur:n,errors:u,touched:l})=>e.jsxs(me,{className:"row g-3 needs-validation",onSubmit:a,children:[e.jsxs(m,{md:5,children:[e.jsx(j,{htmlFor:"title",children:"Title"}),e.jsx(y,{type:"text",name:"title",value:i.title,onChange:p}),u.title&&l.title&&e.jsx(C,{className:"text-danger small",children:u.title})]}),e.jsxs(m,{md:2,children:[e.jsx(j,{htmlFor:"duration",children:"Duration"}),e.jsx(y,{type:"text",name:"duration",value:i.duration,onChange:p}),u.duration&&l.duration&&e.jsx(C,{className:"text-danger small",children:u.duration})]}),e.jsxs(m,{md:5,children:[e.jsxs(j,{htmlFor:"thumbnail",children:["Thumbnail",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(y,{type:"file",accept:"image/*",name:"thumbnail",onChange:o=>{const N=o.target.files[0];N&&(X(N),_(!0))},ref:g}),i.thumbnail&&e.jsx(b,{color:"primary",size:"md",type:"button",onClick:()=>U(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(ce,{show:ee,imageFile:Q,onClose:()=>_(!1),onCropDone:o=>{c("thumbnail",o)}}),e.jsx(ue,{visible:te,imageFile:i.thumbnail,onClose:()=>U(!1)})]}),u.thumbnail&&l.thumbnail&&e.jsx(C,{className:"text-danger small",children:u.thumbnail})]}),e.jsxs(m,{md:2,children:[e.jsx(j,{htmlFor:"videoType",children:"Video Type"}),e.jsxs(he,{id:"videoType",value:w,onChange:o=>{const N=o.target.value;A(N),c("video",""),g.current&&(g.current.value="")},children:[e.jsx("option",{value:"file",children:"Upload File"}),e.jsx("option",{value:"url",children:"YouTube URL"})]})]}),w==="file"&&e.jsxs(m,{md:5,children:[e.jsxs(j,{htmlFor:"video",children:["Video File",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(y,{type:"file",accept:"video/*",name:"video",onChange:o=>c("video",o.target.files[0]),ref:g}),u.video&&l.video&&e.jsx(C,{className:"text-danger small",children:u.video})]}),w==="url"&&e.jsxs(m,{md:6,children:[e.jsxs(j,{htmlFor:"video",children:["YouTube URL",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(y,{type:"url",name:"video",placeholder:"https://www.youtube.com/watch?v=...",value:i.video,onChange:p,onBlur:n}),u.video&&l.video&&e.jsx(C,{className:"text-danger small",children:u.video})]}),e.jsx(m,{xs:12,children:e.jsx(b,{color:"primary",type:"submit",children:"Submit"})})]})})}):null]}),e.jsxs("div",{className:"mt-4",children:[x&&e.jsx(J,{color:"primary",children:x}),L&&e.jsx(J,{color:"danger",children:L})]}),e.jsx(Ae,{banners:t,formData:z,handleDelete:Fe,handleUpdate:se,setActiveForm:h,setShowForm:V})]}),e.jsx(Be,{visible:D,onClose:()=>B(!1),onConfirm:Se,title:"Confirm Delete",message:"Are you sure you want to delete this banner?"})]})})};export{pt as default};
