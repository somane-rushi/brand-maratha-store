import{a as i,j as e,C as de}from"./index-f6D6TMGS.js";import{a as E}from"./axios.config-D8NC-S8h.js";import{L as ue,M as pe,N as fe,O as ge,P as he,Q as xe,R as je,S as be,T as ye}from"./api.endpoints-D7eIfK11.js";import{M as Ce}from"./Modal-Byr5KNe-.js";import{T as Fe}from"./AboutUsBannerTable-B7G7y3QP.js";import{c as W,a as J,b as H,F as Q}from"./formik.esm-DzZc3OM4.js";import{h as D}from"./errorHelper-EbapN-iz.js";import{I as K,a as X}from"./ImagePreview-BEQ8m4jE.js";import{C as Se,a as r}from"./CRow-C5aZ3uce.js";import{C as ke,a as we}from"./CCardBody-DyHbCEEC.js";import{C as Be}from"./CCardHeader-BkEnHaV2.js";import{C as Ne}from"./CFormSelect-BM6fWH_8.js";import{C as F}from"./CButton-ByJ5g7iZ.js";import{C as Y}from"./CForm-BElthXFv.js";import{C as f,a as g}from"./CFormControlWrapper-aXjT4m4y.js";import{C as h}from"./CFormInput-CzlD-ECf.js";import{C as Z}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./index.esm-B7prAHhm.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";import"./CTable-Bj0B-88c.js";import"./cil-pen-53d2I-C-.js";import"./cil-trash-CBbKHhHb.js";import"./index-C7_v8csn.js";const et=()=>{const[x,ee]=i.useState([]),[j,te]=i.useState("english"),[k,b]=i.useState(""),[w,B]=i.useState(!1),[T,M]=i.useState(!1),[o,ae]=i.useState(null),[ie,P]=i.useState(!1),[se,L]=i.useState(null),[c,z]=i.useState({}),U=i.useRef(!0),y=i.useRef(null),[C,R]=i.useState(null),[ne,d]=i.useState(!1),[N,u]=i.useState(""),[A,$]=i.useState(null),[O,_]=i.useState(!1),[G,I]=i.useState(!1),le=W().shape({link:H().url("Invalid URL format"),image:J().nullable().test("fileRequired","Image is required",function(t){const{existing_image:l}=this.parent;return!l&&!t?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})}),re=W().shape({link:H().url("Invalid URL format"),image:J().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})});i.useEffect(()=>{c.image&&R(c.image)},[c.image]),i.useEffect(()=>{ae({getBanner:j==="english"?je:be,postBanner:j==="english"?he:xe,putBanner:j==="english"?fe:ge,deleteBanner:j==="english"?ue:pe})},[j]),i.useEffect(()=>{if(U.current){U.current=!1;return}o&&v(o)},[o]),i.useEffect(()=>{if(k||N){const t=setTimeout(()=>{b(""),u("")},3e3);return()=>clearTimeout(t)}},[k,N]);const v=async t=>{d(!0),u("");try{const{data:l}=await E.get(t.getBanner);ee(l)}catch(l){u(D(l))}finally{d(!1)}};async function oe(t,{resetForm:l}){d(!0),u(""),b("");const s={title:t.title.trim(),subtitle:t.subtitle.trim(),link:t.link.trim()},n=new FormData;n.append("title",s.title),n.append("subtitle",s.subtitle),n.append("link",s.link),n.append("image",t.image);try{await E.post(o.postBanner,n,{headers:{"Content-Type":"multipart/form-data"}}),b("Banner created successfully!"),v(o),y.current&&(y.current.value=""),l(),B(!1)}catch(a){u(D(a))}finally{d(!1)}}const me=t=>{L(t),P(!0)};async function ce(){d(!0);try{await E.delete(`${o.deleteBanner}/${se}`),v(o),M(!1)}catch(t){u(D(t))}finally{P(!1),L(null),d(!1)}}async function q(t,{resetForm:l}){if(d(!0),u(""),b(""),c.id===null){b("Please select a banner first.");return}const s={title:t.title.trim(),subtitle:t.subtitle.trim(),link:t.link.trim()},n=new FormData;n.append("title",s.title),n.append("subtitle",s.subtitle),n.append("link",s.link),t.image instanceof File&&n.append("image",t.image);try{await E.put(`${o.putBanner}/${c.id}`,n,{headers:{"Content-Type":"multipart/form-data"}}),b("Banner updated successfully!"),v(o),y.current&&(y.current.value=""),z({}),R(""),B(!1),l()}catch(a){u(D(a))}finally{d(!1)}}const V=()=>{B(!w),M(!1)};return ne?e.jsx(de,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(e.Fragment,{children:e.jsxs(Se,{children:[e.jsxs(r,{xs:12,children:[e.jsxs(ke,{className:"mb-4",children:[e.jsxs(Be,{children:[e.jsxs("strong",{children:[" ",T?"Update":"Add"]})," ",e.jsx("small",{children:"Banner"})]}),e.jsxs(we,{className:"row g-3",children:[e.jsx(r,{xs:12,md:4,lg:2,children:e.jsxs(Ne,{"aria-label":"Default select example",value:j,onChange:t=>te(t.target.value),disabled:w,children:[e.jsx("option",{value:"english",children:"English"}),e.jsx("option",{value:"marathi",children:"मराठी"})]})}),e.jsx(r,{xs:12,md:6,children:w?e.jsx(F,{as:"input",type:"button",color:"primary",value:"Close",onClick:V}):(x==null?void 0:x.length)<7&&e.jsx(F,{as:"input",type:"button",color:"primary",value:"Add",onClick:V})}),w?T?e.jsx(e.Fragment,{children:e.jsx(Q,{initialValues:{title:c.title||"",subtitle:c.subtitle||"",link:c.link||"",image:null},enableReinitialize:!0,validationSchema:re,onSubmit:q,children:({values:t,setFieldValue:l,handleChange:s,handleSubmit:n,errors:a,touched:m})=>e.jsxs(Y,{className:"row g-3 needs-validation",onSubmit:n,children:[e.jsxs(r,{md:6,children:[e.jsx(f,{htmlFor:"title",children:"Title"}),e.jsx(h,{type:"text",name:"title",value:t.title,onChange:s}),a.title&&m.title&&e.jsx(g,{className:"text-danger small",children:a.title})]}),e.jsxs(r,{md:6,children:[e.jsx(f,{htmlFor:"subtitle",children:"Sub Title"}),e.jsx(h,{type:"text",name:"subtitle",value:t.subtitle,onChange:s}),a.subtitle&&m.subtitle&&e.jsx(g,{className:"text-danger small",children:a.subtitle})]}),e.jsxs(r,{md:6,children:[e.jsx(f,{htmlFor:"link",children:"Link"}),e.jsx(h,{type:"text",name:"link",value:t.link,onChange:s}),a.link&&m.link&&e.jsx(g,{className:"text-danger small",children:a.link})]}),e.jsxs(r,{md:6,children:[e.jsxs(f,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(h,{type:"file",accept:"image/*",name:"image",onChange:p=>{const S=p.target.files[0];S&&($(S),_(!0))},ref:y}),C&&e.jsx(F,{color:"primary",size:"md",type:"button",onClick:()=>I(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(K,{show:O,imageFile:A,onClose:()=>_(!1),onCropDone:p=>{l("image",p),R(URL.createObjectURL(p))}}),e.jsx(X,{visible:G,imageFile:C!=null&&C.startsWith("blob:")?C:ye+C,onClose:()=>I(!1)})]}),a.image&&m.image&&e.jsx(g,{className:"text-danger small",children:a.image})]}),e.jsx(r,{xs:12,children:e.jsx(F,{color:"primary",type:"submit",children:"Update"})})]})})}):(x==null?void 0:x.length)<7&&e.jsx(Q,{initialValues:{title:"",subtitle:"",link:"",image:null},enableReinitialize:!0,validationSchema:le,onSubmit:oe,children:({values:t,setFieldValue:l,handleChange:s,handleSubmit:n,errors:a,touched:m})=>e.jsxs(Y,{className:"row g-3 needs-validation",onSubmit:n,children:[e.jsxs(r,{md:6,children:[e.jsx(f,{htmlFor:"title",children:"Title"}),e.jsx(h,{type:"text",name:"title",value:t.title,onChange:s}),a.title&&m.title&&e.jsx(g,{className:"text-danger small",children:a.title})]}),e.jsxs(r,{md:6,children:[e.jsx(f,{htmlFor:"subtitle",children:"Sub Title"}),e.jsx(h,{type:"text",name:"subtitle",value:t.subtitle,onChange:s}),a.subtitle&&m.subtitle&&e.jsx(g,{className:"text-danger small",children:a.subtitle})]}),e.jsxs(r,{md:6,children:[e.jsx(f,{htmlFor:"link",children:"Link"}),e.jsx(h,{type:"text",name:"link",value:t.link,onChange:s}),a.link&&m.link&&e.jsx(g,{className:"text-danger small",children:a.link})]}),e.jsxs(r,{md:6,children:[e.jsxs(f,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(h,{type:"file",accept:"image/*",name:"image",onChange:p=>{const S=p.target.files[0];S&&($(S),_(!0))},ref:y}),t.image&&e.jsx(F,{color:"primary",size:"md",type:"button",onClick:()=>I(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(K,{show:O,imageFile:A,onClose:()=>_(!1),onCropDone:p=>{l("image",p)}}),e.jsx(X,{visible:G,imageFile:t.image,onClose:()=>I(!1)})]}),a.image&&m.image&&e.jsx(g,{className:"text-danger small",children:a.image})]}),e.jsx(r,{xs:12,children:e.jsx(F,{color:"primary",type:"submit",children:"Submit"})})]})}):null]})]}),e.jsxs("div",{className:"mt-4",children:[k&&e.jsx(Z,{color:"primary",children:k}),N&&e.jsx(Z,{color:"danger",children:N})]}),e.jsx(Fe,{name:"",banners:x,formData:z,handleDelete:me,handleUpdate:q,setActiveForm:M,setShowForm:B})]}),e.jsx(Ce,{visible:ie,onClose:()=>P(!1),onConfirm:ce,title:"Confirm Delete",message:"Are you sure you want to delete this banner?"})]})})};export{et as default};
