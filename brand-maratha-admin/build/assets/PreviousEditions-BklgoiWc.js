import{j as e,a,C as ue}from"./index-f6D6TMGS.js";import{a as R}from"./axios.config-D8NC-S8h.js";import{r as B,bd as xe,be as ge,bf as je,bg as be}from"./api.endpoints-D7eIfK11.js";import{M as ye}from"./Modal-Byr5KNe-.js";import{b as Q}from"./index.esm-B7prAHhm.js";import{C as ie,a as o}from"./CRow-C5aZ3uce.js";import{C as ae,a as $}from"./CCardBody-DyHbCEEC.js";import{C as q}from"./CCardHeader-BkEnHaV2.js";import{C as Ce,a as Fe,b as X,c as F,d as we,e as _}from"./CTable-Bj0B-88c.js";import{C as h}from"./CButton-ByJ5g7iZ.js";import{c as Se}from"./cil-pen-53d2I-C-.js";import{c as Pe}from"./cil-trash-CBbKHhHb.js";import{F as Y,c as re,a as A,b as ne}from"./formik.esm-DzZc3OM4.js";import{h as k}from"./errorHelper-EbapN-iz.js";import{I as Z,a as ee}from"./ImagePreview-BEQ8m4jE.js";import{C as te}from"./CForm-BElthXFv.js";import{C as w,a as S}from"./CFormControlWrapper-aXjT4m4y.js";import{C as P}from"./CFormInput-CzlD-ECf.js";import{C as se}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";import"./index-C7_v8csn.js";const Te=({editions:t,formData:T,handleDelete:j,setActiveForm:p,setShowForm:D})=>{const b=r=>{T(r),p(!0),D(!0)};return e.jsx(ie,{children:e.jsx(o,{xs:12,children:e.jsxs(ae,{className:"mb-4",children:[e.jsxs(q,{children:[e.jsx("strong",{children:"Edition"})," ",e.jsx("small",{children:"List"})]}),e.jsx($,{children:(t==null?void 0:t.length)>0?e.jsxs(Ce,{hover:!0,children:[e.jsx(Fe,{children:e.jsxs(X,{children:[e.jsx(F,{scope:"col",children:"Index"}),e.jsx(F,{scope:"col",children:"Title"}),e.jsx(F,{scope:"col",children:"Thumbnail"}),e.jsx(F,{scope:"col",children:"PDF"}),e.jsx(F,{scope:"col",children:"Action"})]})}),e.jsx(we,{children:t==null?void 0:t.map((r,y)=>e.jsx(a.Fragment,{children:e.jsxs(X,{children:[e.jsx(F,{scope:"row",children:y+1}),e.jsx(_,{children:(r==null?void 0:r.title)||"-"}),e.jsx(_,{children:e.jsx("img",{src:B+r.image,height:"40px",width:"auto",alt:"Banner"})}),e.jsx(_,{children:r!=null&&r.pdf?e.jsx(h,{color:"primary",size:"sm",onClick:()=>window.open(B+r.pdf,"_blank"),children:"View PDF"}):"No PDF Available"}),e.jsxs(_,{children:[e.jsx(h,{type:"button",color:"success",onClick:()=>b(r),children:e.jsx(Q,{icon:Se,size:"md"})}),e.jsx(h,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>j(r==null?void 0:r.id),children:e.jsx(Q,{icon:Pe,size:"md"})})]})]})},y))})]}):e.jsx(q,{children:e.jsx("strong",{children:"No banner found!"})})})]})})})},De=re().shape({title:ne().trim().max(255,"Title must be at most 255 characters").test("no-whitespace","Title cannot be only spaces",t=>!t||t.trim()===""?!0:t.trim().length>0),image:A().test("fileRequired","Image is required",function(t){const{existing_image:T}=this.parent;return!T&&!t?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0}),pdf:A().required("PDF is required").test("fileType","Only PDF files are allowed",t=>!t||typeof t!="object"?!0:t.type==="application/pdf").test("fileSize","PDF size must be less than 10MB",function(t){return!t||typeof t!="object"?!0:t.size<=10*1024*1024})}),Ne=re().shape({title:ne().nullable().notRequired().test("no-whitespace","Title cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Title must be at most 255 characters").test("no-whitespace","Title cannot be only spaces",t=>!t||t.trim()===""?!0:t.trim().length>0),image:A().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0}),pdf:A().nullable().test("fileType","Only PDF files are allowed",t=>!t||typeof t!="object"?!0:t.type==="application/pdf").test("fileSize","PDF size must be less than 10MB",function(t){return!t||typeof t!="object"?!0:t.size<=10*1024*1024})}),Ze=()=>{const[t,T]=a.useState([]),[j,p]=a.useState(""),[D,b]=a.useState(!1),[r,y]=a.useState(!1),[le,L]=a.useState(!1),[oe,v]=a.useState(null),[u,G]=a.useState({}),[C,U]=a.useState(""),[O,ce]=a.useState(""),[de,f]=a.useState(!1),[N,c]=a.useState(""),z=a.useRef(null),[H,V]=a.useState(null),[W,E]=a.useState(!1),[J,I]=a.useState(!1);a.useEffect(()=>{M()},[]),a.useEffect(()=>{if(j||N){const s=setTimeout(()=>{p(""),c("")},3e3);return()=>clearTimeout(s)}},[j,N]),a.useEffect(()=>{const{image:s}=u;s&&U(s)},[u.image]);const M=async()=>{f(!0),c("");try{const{data:s}=await R.get(xe);T(s)}catch(s){c(k(s))}finally{f(!1)}};async function me(s,{resetForm:d}){f(!0),p(""),c("");const x={title:s.title.trim()},n=new FormData;n.append("title",x.title),n.append("image",s.image),n.append("pdf",s.pdf);try{const{data:i}=await R.post(ge,n,{headers:{"Content-Type":"multipart/form-data"}});p(i==null?void 0:i.message),M(),d(),b(!1)}catch(i){c(k(i))}finally{f(!1)}}const pe=s=>{v(s),L(!0)};async function fe(){f(!0),c("");try{await R.delete(`${be}/${oe}`),M(),y(!1)}catch(s){c(k(s))}finally{L(!1),v(null),f(!1)}}async function K(s,{resetForm:d}){if(f(!0),p(""),c(""),u.id===null){p("Please select a banner first.");return}const x={title:s.title.trim()},n=new FormData;n.append("title",x.title),s.image instanceof File&&n.append("image",s.image),s.pdf instanceof File&&n.append("pdf",s.pdf);try{await R.put(`${je}/${u.id}`,n,{headers:{"Content-Type":"multipart/form-data"}}),p("Edition updated successfully!"),M(),G({}),U(""),d(),b(!1)}catch(i){c(k(i))}finally{f(!1)}}const he=()=>{b(!D),y(!1)};return de?e.jsx(ue,{color:"primary"}):e.jsx(e.Fragment,{children:e.jsxs(ie,{children:[e.jsxs(o,{xs:12,children:[e.jsxs(ae,{className:"mb-4",children:[e.jsxs(q,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[" ",r?"Update":"Add"]})," ",e.jsx("small",{children:"Edition"})]}),e.jsx(h,{as:"input",type:"button",color:"primary",value:D!==!0?"Add":"Close",onClick:()=>he()})]}),D?r?e.jsx(e.Fragment,{children:e.jsx($,{children:e.jsx(Y,{initialValues:{title:u.title||"",image:u.image||null,pdf:u.pdf||null},enableReinitialize:!0,validationSchema:Ne,onSubmit:K,children:({values:s,setFieldValue:d,handleChange:x,handleSubmit:n,errors:i,touched:g})=>e.jsxs(te,{className:"row g-3 needs-validation",onSubmit:n,children:[e.jsxs(o,{md:12,children:[e.jsx(w,{htmlFor:"title",children:"Title"}),e.jsx(P,{type:"text",name:"title",value:s.title,onChange:x}),i.title&&g.title&&e.jsx(S,{className:"text-danger small",children:i.title})]}),e.jsxs(o,{md:6,children:[e.jsxs(w,{htmlFor:"image",children:["Thumbnail",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(P,{type:"file",accept:"image/*",name:"image",onChange:l=>{const m=l.target.files[0];m&&(V(m),E(!0))},ref:z}),C&&e.jsx(h,{color:"primary",size:"md",type:"button",onClick:()=>I(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(Z,{show:W,imageFile:H,onClose:()=>E(!1),onCropDone:l=>{d("image",l),U(URL.createObjectURL(l))}}),e.jsx(ee,{visible:J,imageFile:C!=null&&C.startsWith("blob:")?C:B+C,onClose:()=>I(!1)})]}),i.image&&g.image&&e.jsx(S,{className:"text-danger small",children:i.image})]}),e.jsxs(o,{md:6,children:[e.jsxs(w,{htmlFor:"pdf",children:["PDF",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(P,{type:"file",accept:"application/pdf",name:"pdf",onChange:l=>{const m=l.target.files[0];m&&(d("pdf",m),ce(URL.createObjectURL(m)))},ref:z}),s.pdf&&!O&&e.jsx("a",{href:B+s.pdf,target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",children:"View"}),O&&e.jsx("a",{href:O,target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",children:"Preview"})]}),i.pdf&&g.pdf&&e.jsx(S,{className:"text-danger small",children:i.pdf})]}),e.jsx(o,{xs:12,children:e.jsx(h,{color:"primary",type:"submit",children:"Update"})})]})})})}):e.jsx($,{className:"row g-3",children:e.jsx(Y,{initialValues:{title:"",image:null,pdf:null},enableReinitialize:!0,validationSchema:De,onSubmit:me,children:({values:s,setFieldValue:d,handleChange:x,handleSubmit:n,errors:i,touched:g})=>e.jsxs(te,{className:"row g-3 needs-validation",onSubmit:n,children:[e.jsxs(o,{md:12,children:[e.jsx(w,{htmlFor:"title",children:"Title"}),e.jsx(P,{type:"text",name:"title",value:s.title,onChange:x}),i.title&&g.title&&e.jsx(S,{className:"text-danger small",children:i.title})]}),e.jsxs(o,{md:6,children:[e.jsxs(w,{htmlFor:"image",children:["Thumbnail",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(P,{type:"file",accept:"image/*",name:"image",onChange:l=>{const m=l.target.files[0];m&&(V(m),E(!0))},ref:z}),s.image&&e.jsx(h,{color:"primary",size:"md",type:"button",onClick:()=>I(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(Z,{show:W,imageFile:H,onClose:()=>E(!1),onCropDone:l=>{d("image",l)}}),e.jsx(ee,{visible:J,imageFile:s.image,onClose:()=>I(!1)})]}),i.image&&g.image&&e.jsx(S,{className:"text-danger small",children:i.image})]}),e.jsxs(o,{md:6,children:[e.jsxs(w,{htmlFor:"pdf",children:["PDF",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(P,{type:"file",accept:"pdf/*",name:"pdf",onChange:l=>d("pdf",l.target.files[0]),ref:z}),i.pdf&&g.pdf&&e.jsx(S,{className:"text-danger small",children:i.pdf})]}),e.jsx(o,{xs:12,children:e.jsx(h,{color:"primary",type:"submit",children:"Submit"})})]})})}):null]}),e.jsxs("div",{className:"mt-4",children:[j&&e.jsx(se,{color:"primary",children:j}),N&&e.jsx(se,{color:"danger",children:N})]}),e.jsx(Te,{editions:t,formData:G,handleDelete:pe,handleUpdate:K,setActiveForm:y,setShowForm:b})]}),e.jsx(ye,{visible:le,onClose:()=>L(!1),onConfirm:fe,title:"Confirm Delete",message:"Are you sure you want to delete this edition?"})]})})};export{Ze as default};
