import{u as ue,j as e,m as V,a as l,C as G}from"./index-f6D6TMGS.js";import{a as q}from"./axios.config-D8NC-S8h.js";import{c as Q,T as H,bh as ge,bj as he,bk as be}from"./api.endpoints-D7eIfK11.js";import{u as X,C as ee}from"./index-BvccmHzl.js";import{F as te,c as ie,a as M,b as A,e as ae,d as ne}from"./formik.esm-DzZc3OM4.js";import{h as R}from"./errorHelper-EbapN-iz.js";import{I as J,a as Z}from"./ImagePreview-BEQ8m4jE.js";import{C as W}from"./CAlert-Ceafrkex.js";import{C as re,a as d}from"./CRow-C5aZ3uce.js";import{C as se,a as le}from"./CCardBody-DyHbCEEC.js";import{C as oe}from"./CCardHeader-BkEnHaV2.js";import{C as me}from"./CForm-BElthXFv.js";import{C as u,a as g}from"./CFormControlWrapper-aXjT4m4y.js";import{C as f}from"./CFormInput-CzlD-ECf.js";import{C as de}from"./CFormSelect-BM6fWH_8.js";import{C as T}from"./CButton-ByJ5g7iZ.js";import"./DefaultLayout-BE9qYLzL.js";import"./index.esm-B7prAHhm.js";import"./cil-user-Ddrdy7PS.js";import"./index-C7_v8csn.js";import"./CModalHeader-fVen3JA5.js";const pe=ie().shape({title:A().nullable().notRequired().test("no-whitespace","Title cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Title must be at most 255 characters"),subtitle:A().nullable().notRequired().test("no-whitespace","Subtitle cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Subtitle must be at most 255 characters"),author:A().required("Author is required").test("no-whitespace","Author cannot be empty or only spaces",t=>t&&t.trim().length>0).max(255,"Author must be at most 255 characters").test("word-count",function(t){if(!t)return this.createError({message:"Author is required"});const C=t.trim().split(/\s+/).length;return C>5?this.createError({message:`Author must not exceed 5 words. Currently, it has ${C}.`}):!0}).matches(/^[a-zA-Z0-9\s.,!?()-]+$/,"Author contains invalid characters"),brand:ne().required("brand is required"),date:ae().required("Date is required").typeError("Invalid date format"),content:A().required("Content is required"),thumbnail_image:M().required("Thumbnail image is required").test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","Image size must be less than 5MB",t=>!t||typeof t!="object"?!0:t.size<=5*1024*1024),banner_image:M().nullable().required("Banner image is required").test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","Image size must be less than 5MB",t=>!t||typeof t!="object"?!0:t.size<=5*1024*1024)}),xe=ie().shape({title:A().nullable().notRequired().test("no-whitespace","Title cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Title must be at most 255 characters"),subtitle:A().nullable().notRequired().test("no-whitespace","Subtitle cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Subtitle must be at most 255 characters"),author:A().required("Author is required").test("no-whitespace","Author cannot be empty or only spaces",t=>t&&t.trim().length>0).max(255,"Author must be at most 255 characters").test("word-count",function(t){if(!t)return this.createError({message:"Author is required"});const C=t.trim().split(/\s+/).length;return C>5?this.createError({message:`Author must not exceed 5 words. Currently, it has ${C}.`}):!0}).matches(/^[a-zA-Z0-9\s.,!?()-]+$/,"Author contains invalid characters"),brand:ne().required("brand is required"),date:ae().nullable().required("Date is required").typeError("Invalid date format"),content:A().required("Content is required"),thumbnail_image:M().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","Image size must be less than 5MB",t=>!t||typeof t!="object"?!0:t.size<=5*1024*1024),banner_image:M().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","Image size must be less than 5MB",t=>!t||typeof t!="object"?!0:t.size<=5*1024*1024)}),fe=({licenseKey:t})=>{const C=V(),i=X({version:"44.2.0",premium:!0}),[I,h]=l.useState([]),[Y,P]=l.useState(!1),[k,E]=l.useState(""),[w,L]=l.useState(""),[S,_]=l.useState(null),[b,y]=l.useState(null),[v,p]=l.useState(!1),[z,N]=l.useState(!1),[D,K]=l.useState(!1),O=l.useRef(null);l.useEffect(()=>{if(w||k){const o=setTimeout(()=>{L(""),E("")},3e3);return()=>clearTimeout(o)}},[w,k]),l.useEffect(()=>{U()},[]);const U=async()=>{P(!0);try{const{data:o}=await q.get(Q);h(o)}catch(o){E(R(o))}finally{P(!1)}},$=async(o,{resetForm:F})=>{P(!0),E(""),L("");const x={title:o.title.trim(),subtitle:o.subtitle.trim(),author:o.author.trim(),content:o.content.trim()},a=new FormData;a.append("title",x.title),a.append("subtitle",x.subtitle),a.append("author",x.author),a.append("brand",Number(o.brand)),a.append("date",o.date),a.append("content",x.content),a.append("thumbnail_image",o.thumbnail_image),a.append("banner_image",o.banner_image);try{await q.post(be,a,{headers:{"Content-Type":"multipart/form-data"}}),L("Blog added successfully!"),O.current&&(O.current.value=""),F(),C("/brand-details")}catch(m){E(R(m))}finally{P(!1)}};return i.status==="error"?e.jsx(W,{children:"Error..."}):i.status==="loading"?e.jsx(G,{color:"primary"}):Y?e.jsx(G,{color:"primary"}):e.jsx(re,{children:e.jsx(d,{xs:12,children:e.jsxs(se,{className:"mb-4",children:[e.jsxs(oe,{children:[e.jsx("strong",{children:"Add"})," ",e.jsx("small",{children:"Blog"})]}),e.jsxs(le,{className:"row g-3",children:[e.jsx(te,{initialValues:{title:"",subtitle:"",author:"",brand:null,date:null,content:"",thumbnail_image:null,banner_image:null},enableReinitialize:!0,validationSchema:pe,onSubmit:$,children:({values:o,setFieldValue:F,handleChange:x,handleSubmit:a,errors:m,touched:n})=>e.jsxs(me,{className:"row g-3",onSubmit:a,children:[e.jsxs(d,{md:4,children:[e.jsx(u,{children:"Title"}),e.jsx(f,{type:"text",name:"title",value:o.title,onChange:x}),m.title&&n.title&&e.jsx(g,{className:"text-danger small",children:m.title})]}),e.jsxs(d,{md:8,children:[e.jsx(u,{children:"Subtitle"}),e.jsx(f,{type:"text",name:"subtitle",value:o.subtitle,onChange:x}),m.subtitle&&n.subtitle&&e.jsx(g,{className:"text-danger small",children:m.subtitle})]}),e.jsxs(d,{md:4,children:[e.jsxs(u,{children:["Author",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(f,{type:"text",name:"author",value:o.author,onChange:x}),m.author&&n.author&&e.jsx(g,{className:"text-danger small",children:m.author})]}),e.jsxs(d,{md:4,children:[e.jsxs(u,{htmlFor:"brand",children:["Brand",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(de,{name:"brand",onChange:x,children:[e.jsx("option",{children:"Select Brand"}),I==null?void 0:I.map(s=>e.jsx(l.Fragment,{children:e.jsx("option",{value:s.id,children:s==null?void 0:s.name})},s.id))]}),m.brand&&n.brand&&e.jsx("div",{className:"text-danger small",children:m.brand})]}),e.jsxs(d,{md:4,children:[e.jsxs(u,{children:["Date",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(f,{type:"date",name:"date",value:o.date,onChange:x}),m.date&&n.date&&e.jsx(g,{className:"text-danger small",children:m.date})]}),e.jsxs(d,{md:6,children:[e.jsxs(u,{children:["Thumbnail Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(f,{type:"file",accept:"image/*",name:"thumbnail_image",onChange:s=>{const r=s.target.files[0];r&&(_(r),y("thumbnail_image"),p(!0))}}),o.thumbnail_image&&e.jsx(T,{color:"primary",size:"md",type:"button",onClick:()=>N(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(J,{show:v,imageFile:S,onClose:()=>{p(!1),_(null),y(null)},onCropDone:s=>{b&&F(b,s),p(!1),_(null),y(null)}}),e.jsx(Z,{visible:z,imageFile:o.thumbnail_image,onClose:()=>N(!1)})]}),m.thumbnail_image&&n.thumbnail_image&&e.jsx(g,{className:"text-danger small",children:m.thumbnail_image})]}),e.jsxs(d,{md:6,children:[e.jsxs(u,{children:["Banner Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(f,{type:"file",accept:"image/*",name:"banner_image",onChange:s=>{const r=s.target.files[0];r&&(_(r),y("banner_image"),p(!0))}}),o.banner_image&&e.jsx(T,{color:"primary",size:"md",type:"button",onClick:()=>K(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(J,{show:v,imageFile:S,onClose:()=>{p(!1),_(null),y(null)},onCropDone:s=>{b&&F(b,s),p(!1),_(null),y(null)}}),e.jsx(Z,{visible:D,imageFile:o.banner_image,onClose:()=>K(!1)})]}),m.banner_image&&n.banner_image&&e.jsx(g,{className:"text-danger small",children:m.banner_image})]}),e.jsxs(d,{xs:12,children:[e.jsx(ee,{editor:i.CKEditor.ClassicEditor,data:o.content,config:{licenseKey:t,plugins:[i.CKEditor.Essentials,i.CKEditor.Paragraph,i.CKEditor.Heading,i.CKEditor.Bold,i.CKEditor.Italic,i.CKEditor.RemoveFormat,i.CKEditor.Strikethrough,i.CKEditor.Autoformat,i.CKEditor.Font,i.CKEditor.FontSize,i.CKEditor.Alignment,i.CKEditor.List,i.CKEditor.ListProperties,i.CKEditor.Table,i.CKEditor.Link,i.CKEditor.Image,i.CKEditor.ImageToolbar,i.CKEditor.ImageStyle,i.CKEditor.ImageInsert,i.CKEditor.Base64UploadAdapter,i.CKEditor.AutoImage,i.CKEditor.ImageUpload,i.CKEditor.Alignment],toolbar:{items:["undo","redo","|","heading","|","fontfamily","fontsize","|","fontColor","fontBackgroundColor","|","bold","italic","strikethrough","removeFormat","|","alignment","|","bulletedList","numberedList","todoList","|","outdent","indent","|","insertImage","|","link","blockQuote","codeBlock"],shouldNotGroupWhenFull:!1},image:{styles:["alignLeft","alignCenter","alignRight"],toolbar:["imageTextAlternative","imageStyle:alignLeft","imageStyle:alignCenter","imageStyle:alignRight"],style:{definitions:[{name:"Align left",title:"Align left",modelElements:["imageBlock"],class:"image-style-align-left"},{name:"Align center",title:"Align center",modelElements:["imageBlock"],class:"image-style-align-center"},{name:"Align right",title:"Align right",modelElements:["imageBlock"],class:"image-style-align-right"},{name:"Full size image",title:"Full",modelElements:["imageBlock"],class:"image-style-full"},{name:"Side image",title:"Side",modelElements:["imageBlock"],class:"image-style-side"}]}}},onChange:(s,r)=>{F("content",r.getData())}}),m.content&&n.content&&e.jsx(g,{className:"text-danger small",children:m.content})]}),e.jsx(d,{xs:12,children:e.jsx(T,{color:"primary",type:"submit",children:"Submit"})})]})}),e.jsxs("div",{className:"mt-4",children:[w&&e.jsx(W,{color:"primary",children:w}),k&&e.jsx(W,{color:"danger",children:k})]})]})]})})})},je=({blogId:t,licenseKey:C})=>{const i=X({version:"44.2.0",premium:!0}),I=V(),[h,Y]=l.useState({title:"",subtitle:"",author:"",date:"",content:"",thumbnail_image:null,banner_image:null}),[P,k]=l.useState([]),[E,w]=l.useState(""),[L,S]=l.useState(!1),_=l.useRef(null),[b,y]=l.useState({thumbnailPreview:"",bannerPreview:""}),[v,p]=l.useState(null),[z,N]=l.useState(null),[D,K]=l.useState(!1),[O,U]=l.useState(!1),[$,o]=l.useState(!1);l.useEffect(()=>{F()},[]);const F=async()=>{S(!0);try{const{data:a}=await q.get(Q);k(a)}catch(a){setError(R(a))}finally{S(!1)}};l.useEffect(()=>{t&&(async()=>{S(!0);try{const n=(await q.get(`${ge}/${t}`)).data,{thumbnail_image:s,banner_image:r}=n;(s||r)&&y({thumbnailPreview:s,bannerPreview:r}),Y(j=>{var c;return{title:n.title,subtitle:n.subtitle,author:n.author,brand:(c=n==null?void 0:n.brand_id)==null?void 0:c.toString(),date:n.date.split("T")[0],content:n.content,thumbnail_image:n.thumbnail_image instanceof File?n.thumbnail_image:j.thumbnail_image,banner_image:n.banner_image instanceof File?n.banner_image:j.banner_image}})}catch{setError(R(Err))}finally{S(!1)}})()},[t]),l.useEffect(()=>{if(E){const a=setTimeout(()=>{w("")},3e3);return()=>clearTimeout(a)}},[E]);const x=async(a,{resetForm:m})=>{if(S(!0),w(""),!t||t===null){w("Please select a banner first.");return}const n={title:a.title.trim(),subtitle:a.subtitle.trim(),author:a.author.trim(),content:a.content.trim()},s=new FormData;s.append("title",n.title),s.append("subtitle",n.subtitle),s.append("author",n.author),s.append("brand",Number(a.brand)),s.append("date",a.date),s.append("content",n.content),a.thumbnail_image instanceof File&&s.append("thumbnail_image",a.thumbnail_image),a.banner_image instanceof File&&s.append("banner_image",a.banner_image);try{await q.put(`${he}/${t}`,s,{headers:{"Content-Type":"multipart/form-data"}}),w("Blog updated successfully!"),m(),_.current&&(_.current.value=""),y({thumbnailPreview:"",bannerPreview:""}),I("/brand-details")}catch(r){console.log("Brand details error",r),setError(R(r))}finally{S(!1)}};return i.status==="error"?e.jsx(W,{children:"Error..."}):i.status==="loading"?e.jsx(G,{color:"primary",className:"d-block mx-auto my-5"}):L?e.jsx(G,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(re,{children:e.jsx(d,{xs:12,children:e.jsxs(se,{className:"mb-4",children:[e.jsxs(oe,{children:[e.jsx("strong",{children:"Update"})," ",e.jsx("small",{children:"Blog"})]}),e.jsx(le,{className:"row g-3",children:e.jsx(te,{initialValues:{title:h.title,subtitle:h.subtitle,author:h.author,brand:h.brand,date:h.date,content:h.content,thumbnail_image:h.thumbnail_image,banner_image:h.banner_image},enableReinitialize:!0,validationSchema:xe,onSubmit:x,children:({values:a,setFieldValue:m,handleChange:n,handleSubmit:s,errors:r,touched:j})=>e.jsxs(me,{className:"row g-3 needs-validation",onSubmit:s,children:[e.jsxs(d,{md:4,children:[e.jsx(u,{children:"Title"}),e.jsx(f,{type:"text",name:"title",value:a.title,onChange:n}),r.title&&j.title&&e.jsx(g,{className:"text-danger small",children:r.title})]}),e.jsxs(d,{md:8,children:[e.jsx(u,{children:"Subtitle"}),e.jsx(f,{type:"text",name:"subtitle",value:a.subtitle,onChange:n}),r.subtitle&&j.subtitle&&e.jsx(g,{className:"text-danger small",children:r.subtitle})]}),e.jsxs(d,{md:4,children:[e.jsxs(u,{children:["Author",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(f,{type:"text",name:"author",value:a.author,onChange:n}),r.author&&j.author&&e.jsx(g,{className:"text-danger small",children:r.author})]}),e.jsxs(d,{md:4,children:[e.jsxs(u,{htmlFor:"brand",children:["Brand",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(de,{name:"brand",value:a.brand,onChange:n,children:[e.jsx("option",{value:"",children:"Select Brand"}),P==null?void 0:P.map(c=>e.jsx(l.Fragment,{children:e.jsx("option",{value:c.id,children:c.name})},c.id))]}),r.brand&&j.brand&&e.jsx("div",{className:"text-danger small",children:r.brand})]}),e.jsxs(d,{md:4,children:[e.jsxs(u,{children:["Date",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(f,{type:"date",name:"date",value:a.date,onChange:n}),r.date&&j.date&&e.jsx(g,{className:"text-danger small",children:r.date})]}),e.jsxs(d,{md:6,children:[e.jsxs(u,{children:["Thumbnail Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(f,{type:"file",accept:"image/*",name:"thumbnail_image",onChange:c=>{const B=c.target.files[0];B&&(p(B),N("thumbnail_image"),K(!0))}}),b.thumbnailPreview&&e.jsx(T,{color:"primary",size:"md",type:"button",onClick:()=>U(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(J,{show:D,imageFile:v,onClose:()=>{K(!1),p(null),N(null)},onCropDone:c=>{z&&m(z,c),K(!1),p(null),N(null)}}),e.jsx(Z,{visible:O,imageFile:b.thumbnailPreview.startsWith("blob:")?b.thumbnailPreview:H+b.thumbnailPreview,onClose:()=>U(!1)})]}),r.thumbnail_image&&j.thumbnail_image&&e.jsx(g,{className:"text-danger small",children:r.thumbnail_image})]}),e.jsxs(d,{md:6,children:[e.jsxs(u,{children:["Banner Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(f,{type:"file",accept:"image/*",name:"banner_image",onChange:c=>{const B=c.target.files[0];B&&(p(B),N("banner_image"),y(ce=>({...ce,bannerPreview:URL.createObjectURL(B)})),K(!0))}}),b.bannerPreview&&e.jsx(T,{color:"primary",size:"md",type:"button",onClick:()=>o(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(J,{show:D,imageFile:v,onClose:()=>{K(!1),p(null),N(null)},onCropDone:c=>{z&&m(z,c),K(!1),p(null),N(null)}}),e.jsx(Z,{visible:$,imageFile:b.bannerPreview.startsWith("blob:")?b.bannerPreview:H+b.bannerPreview,onClose:()=>o(!1)})]}),r.banner_image&&j.banner_image&&e.jsx(g,{className:"text-danger small",children:r.banner_image})]}),e.jsxs(d,{xs:12,children:[e.jsx(ee,{editor:i.CKEditor.ClassicEditor,data:a.content,config:{licenseKey:C,plugins:[i.CKEditor.Essentials,i.CKEditor.Paragraph,i.CKEditor.Heading,i.CKEditor.Bold,i.CKEditor.Italic,i.CKEditor.RemoveFormat,i.CKEditor.Strikethrough,i.CKEditor.Autoformat,i.CKEditor.Font,i.CKEditor.FontSize,i.CKEditor.Alignment,i.CKEditor.List,i.CKEditor.ListProperties,i.CKEditor.Table,i.CKEditor.Link,i.CKEditor.Image,i.CKEditor.ImageToolbar,i.CKEditor.ImageStyle,i.CKEditor.ImageInsert,i.CKEditor.Base64UploadAdapter,i.CKEditor.AutoImage,i.CKEditor.ImageUpload,i.CKEditor.Alignment],toolbar:{items:["undo","redo","|","heading","|","fontfamily","fontsize","|","fontColor","fontBackgroundColor","|","bold","italic","strikethrough","removeFormat","|","alignment","|","bulletedList","numberedList","todoList","|","outdent","indent","|","insertImage","|","link","blockQuote","codeBlock"],shouldNotGroupWhenFull:!1},image:{styles:["alignLeft","alignCenter","alignRight"],toolbar:["imageTextAlternative","imageStyle:alignLeft","imageStyle:alignCenter","imageStyle:alignRight"],style:{definitions:[{name:"Align left",title:"Align left",modelElements:["imageBlock"],class:"image-style-align-left"},{name:"Align center",title:"Align center",modelElements:["imageBlock"],class:"image-style-align-center"},{name:"Align right",title:"Align right",modelElements:["imageBlock"],class:"image-style-align-right"},{name:"Full size image",title:"Full",modelElements:["imageBlock"],class:"image-style-full"},{name:"Side image",title:"Side",modelElements:["imageBlock"],class:"image-style-side"}]}}},onChange:(c,B)=>{m("content",B.getData())}}),r.content&&j.content&&e.jsx(g,{className:"text-danger small",children:r.content})]}),e.jsx(d,{xs:12,children:e.jsx(T,{color:"primary",type:"submit",children:"Update"})})]})})}),e.jsx("div",{className:"mt-4",children:E&&e.jsx(W,{color:"primary",children:E})})]})})})},De=()=>{const t="eyJhbGciOiJFUzI1NiJ9.eyJleHAiOjE3NzEwMjcxOTksImp0aSI6ImZjYzExNTVkLWE2NWUtNDU3YS04Yzc2LTEzYzZiNDZiMzFjMCIsInVzYWdlRW5kcG9pbnQiOiJodHRwczovL3Byb3h5LWV2ZW50LmNrZWRpdG9yLmNvbSIsImRpc3RyaWJ1dGlvbkNoYW5uZWwiOlsiY2xvdWQiLCJkcnVwYWwiXSwiZmVhdHVyZXMiOlsiRFJVUCJdLCJ2YyI6ImU5OTY3YTBlIn0.cnf8PWSdcKOrwPfY4WDKCG9VCwoNYz2PCH11m_T_kMlkOXgoiTeiRchDrQZx-q2ZuszSZZz63naxSB8d9fKb5A",i=ue().pathname.split("/"),I=i.includes("update"),h=I?i[i.length-1]:null;return e.jsx(e.Fragment,{children:I&&h?e.jsx(je,{blogId:h,licenseKey:t}):e.jsx(fe,{licenseKey:t})})};export{De as default};
