import{j as e,a as i,C as be}from"./index-f6D6TMGS.js";import{a as T}from"./axios.config-D8NC-S8h.js";import{r as le,d as ye,aJ as Ce,aK as we,aL as Se,aM as Fe}from"./api.endpoints-D7eIfK11.js";import{M as Te}from"./Modal-Byr5KNe-.js";import{b as K}from"./index.esm-B7prAHhm.js";import{C as ae,a as o}from"./CRow-C5aZ3uce.js";import{C as re,a as B}from"./CCardBody-DyHbCEEC.js";import{C as L}from"./CCardHeader-BkEnHaV2.js";import{C as Ne,a as Ie,b as Q,c as j,d as Me,e as $}from"./CTable-Bj0B-88c.js";import{C as p}from"./CButton-ByJ5g7iZ.js";import{c as Pe}from"./cil-pen-53d2I-C-.js";import{c as De}from"./cil-trash-CBbKHhHb.js";import{c as X,a as Y,b as A,F as Z}from"./formik.esm-DzZc3OM4.js";import{h as N}from"./errorHelper-EbapN-iz.js";import{I as ee,a as te}from"./ImagePreview-BEQ8m4jE.js";import{C as se}from"./CForm-BElthXFv.js";import{C as b,a as y}from"./CFormControlWrapper-aXjT4m4y.js";import{C}from"./CFormInput-CzlD-ECf.js";import{C as ie}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";import"./index-C7_v8csn.js";const Re=({data:m,formData:k,handleDelete:w,setActiveForm:x,setShowForm:I})=>{const f=s=>{k(s),x(!0),I(!0)};return e.jsx(ae,{children:e.jsx(o,{xs:12,children:e.jsxs(re,{className:"mb-4",children:[e.jsxs(L,{children:[e.jsx("strong",{children:"Collection"})," ",e.jsx("small",{children:"List"})]}),e.jsx(B,{children:(m==null?void 0:m.length)>0?e.jsxs(Ne,{hover:!0,children:[e.jsx(Ie,{children:e.jsxs(Q,{children:[e.jsx(j,{scope:"col",children:"Index"}),e.jsx(j,{scope:"col",children:"Title"}),e.jsx(j,{scope:"col",children:"Sub Title"}),e.jsx(j,{scope:"col",children:"Image"}),e.jsx(j,{scope:"col",children:"Action"})]})}),e.jsx(Me,{children:m==null?void 0:m.map((s,M)=>e.jsx(i.Fragment,{children:e.jsxs(Q,{children:[e.jsx(j,{scope:"row",children:M+1}),e.jsx($,{children:s!=null&&s.title?s==null?void 0:s.title:"-"}),e.jsx($,{children:s!=null&&s.subtitle?s==null?void 0:s.subtitle:"-"}),e.jsx($,{children:e.jsx("img",{src:le+s.image,height:"40px",width:"auto"})}),e.jsxs($,{width:150,children:[e.jsx(p,{type:"button",color:"success",onClick:()=>f(s),children:e.jsx(K,{icon:Pe,size:"md"})}),e.jsx(p,{style:{marginLeft:"10px"},type:"button",color:"danger",onClick:()=>w(s==null?void 0:s.id),children:e.jsx(K,{icon:De,size:"md"})})]})]})},M))})]}):e.jsx(L,{children:e.jsx("strong",{children:"No collections found!"})})})]})})})},st=()=>{const[m,k]=i.useState([]),[w,x]=i.useState(!1),[I,f]=i.useState(!1),[s,M]=i.useState({}),[ne,P]=i.useState(!1),[U,O]=i.useState(null),[D,q]=i.useState(s.image||""),[oe,d]=i.useState(!1),[R,S]=i.useState(""),[z,c]=i.useState(""),g=i.useRef(null),[G,H]=i.useState(null),[J,_]=i.useState(!1),[V,v]=i.useState(!1),[ce,me]=i.useState("Confirm Deletion"),[de,ue]=i.useState("Are you sure you want to delete this category?"),he=X().shape({title:A().nullable().notRequired().test("no-whitespace","Title cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Title must be at most 255 characters"),subtitle:A().nullable().notRequired().test("no-whitespace","Subtitle cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Subtitle must be at most 255 characters"),image:Y().nullable().test("fileRequired","Image is required",function(t){const{existing_image:r}=this.parent;return!r&&!t?this.createError({message:"Image is required"}):!0}).test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})}),pe=X().shape({title:A().nullable().notRequired().test("no-whitespace","Title cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Title must be at most 255 characters"),subtitle:A().nullable().notRequired().test("no-whitespace","Subtitle cannot be empty or only spaces",t=>t==null?!0:t.trim().length>0).max(255,"Subtitle must be at most 255 characters"),image:Y().nullable().test("fileType","Only JPG, PNG, and WebP files are allowed",t=>!t||typeof t!="object"?!0:["image/jpeg","image/png","image/webp"].includes(t.type)).test("fileSize","File size must be less than 5MB",function(t){return!t||typeof t!="object"?!0:t.size>5*1024*1024?this.createError({message:"File exceeds 5MB limit"}):!0})});i.useEffect(()=>{if(R||z){const t=setTimeout(()=>{S(""),c("")},3e3);return()=>clearTimeout(t)}},[R,z]),i.useEffect(()=>{E()},[]),i.useEffect(()=>{q(s.image||"")},[s]);const E=async()=>{d(!0),c("");try{const{data:t}=await T.get(ye);k(t)}catch(t){c(N(t))}finally{d(!1)}};async function xe(t,{resetForm:r}){d(!0),c("");const n={title:t.title.trim(),subtitle:t.subtitle.trim()},l=new FormData;l.append("title",n.title),l.append("subtitle",n.subtitle),l.append("image",t.image);try{await T.post(Ce,l,{headers:{"Content-Type":"multipart/form-data"}}),S("Category created successfully!"),E(),g.current&&(g.current.value=""),r(),x(!1)}catch(a){c(N(a))}finally{d(!1)}}const fe=async t=>{try{const{data:r}=await T.get(`${Se}/${t}`),n=(r==null?void 0:r.data)||[],l=n.length>0;me(l?"Shift Products First":"Confirm Deletion"),ue(l?`Please shift all ${n.length} product's to another collection before deleting this one.`:"Are you sure you want to delete this collection?"),O(l?null:t),P(!0)}catch(r){c(N(r))}};async function ge(){if(U===null){P(!1);return}d(!0);try{await T.delete(`${Fe}/${U}`),E(),f(!1)}catch(t){c(N(t))}finally{P(!1),O(null),d(!1)}}async function W(t,{resetForm:r}){if(d(!0),S(""),c(""),s.id===null){S("Please select first category.");return}const n={title:t.title.trim(),subtitle:t.subtitle.trim()},l=new FormData;l.append("title",n.title),l.append("subtitle",n.subtitle),l.append("image",t.image);try{await T.put(`${we}/${s.id}`,l,{headers:{"Content-Type":"multipart/form-data"}}),S("Category updated successfully!"),E(),g.current&&(g.current.value=""),f(!1),q(""),x(!1),r()}catch(a){c(N(a))}finally{d(!1)}}const je=()=>{x(!w),f(!1)};return oe?e.jsx(be,{color:"primary",className:"d-block mx-auto my-5"}):e.jsx(e.Fragment,{children:e.jsxs(ae,{children:[e.jsxs(o,{xs:12,children:[e.jsxs(re,{className:"mb-4",children:[e.jsx(L,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("strong",{children:I?"Update":"Add"})," ",e.jsx("small",{children:"Collection"})]}),e.jsx(p,{as:"input",type:"button",color:"primary",value:w!==!0?"Add":"Close",onClick:je})]})}),w?I?e.jsx(e.Fragment,{children:e.jsx(B,{className:"row g-3",children:e.jsx(Z,{initialValues:{title:s.title||"",subtitle:s.subtitle||"",image:null},enableReinitialize:!0,validationSchema:pe,onSubmit:W,children:({values:t,setFieldValue:r,handleChange:n,handleSubmit:l,errors:a,touched:h})=>e.jsxs(se,{className:"row g-3 needs-validation",onSubmit:l,children:[e.jsxs(o,{md:4,children:[e.jsx(b,{htmlFor:"title",children:"Title"}),e.jsx(C,{type:"text",name:"title",value:t.title,onChange:n}),a.title&&h.title&&e.jsx(y,{className:"text-danger small",children:a.title})]}),e.jsxs(o,{md:4,children:[e.jsx(b,{htmlFor:"subtitle",children:"Sub Title"}),e.jsx(C,{type:"text",name:"subtitle",value:t.subtitle,onChange:n}),a.subtitle&&h.subtitle&&e.jsx(y,{className:"text-danger small",children:a.subtitle})]}),e.jsxs(o,{md:4,children:[e.jsxs(b,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(C,{type:"file",accept:"image/*",name:"image",onChange:u=>{const F=u.target.files[0];F&&(H(F),_(!0))},ref:g}),D&&e.jsx(p,{color:"primary",size:"md",type:"button",onClick:()=>v(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(ee,{show:J,imageFile:G,onClose:()=>_(!1),onCropDone:u=>{r("image",u),q(URL.createObjectURL(u))}}),e.jsx(te,{visible:V,imageFile:D.startsWith("blob:")?D:le+D,onClose:()=>v(!1)})]}),a.image&&h.image&&e.jsx(y,{className:"text-danger small",children:a.image})]}),e.jsx(o,{xs:12,children:e.jsx(p,{color:"primary",type:"submit",children:"Update"})})]})})})}):e.jsx(B,{className:"row g-3",children:e.jsx(Z,{initialValues:{title:"",subtitle:"",image:null},enableReinitialize:!0,validationSchema:he,onSubmit:xe,children:({values:t,setFieldValue:r,handleChange:n,handleSubmit:l,errors:a,touched:h})=>e.jsxs(se,{className:"row g-3",onSubmit:l,children:[e.jsxs(o,{md:4,children:[e.jsx(b,{htmlFor:"title",children:"Title"}),e.jsx(C,{type:"text",name:"title",value:t.title,onChange:n}),a.title&&h.title&&e.jsx(y,{className:"text-danger small",children:a.title})]}),e.jsxs(o,{md:4,children:[e.jsx(b,{htmlFor:"subtitle",children:"Sub Title"}),e.jsx(C,{type:"text",name:"subtitle",value:t.subtitle,onChange:n}),a.subtitle&&h.subtitle&&e.jsx(y,{className:"text-danger small",children:a.subtitle})]}),e.jsxs(o,{md:4,children:[e.jsxs(b,{htmlFor:"image",children:["Image",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx(C,{type:"file",accept:"image/*",name:"image",onChange:u=>{const F=u.target.files[0];F&&(H(F),_(!0))},ref:g}),t.image&&e.jsx(p,{color:"primary",size:"md",type:"button",onClick:()=>v(!0),children:"Preview"})]}),e.jsxs("div",{children:[e.jsx(ee,{show:J,imageFile:G,onClose:()=>_(!1),onCropDone:u=>{r("image",u)}}),e.jsx(te,{visible:V,imageFile:t.image,onClose:()=>v(!1)})]}),a.image&&h.image&&e.jsx(y,{className:"text-danger small",children:a.image})]}),e.jsx(o,{xs:12,children:e.jsx(p,{color:"primary",type:"submit",children:"Submit"})})]})})}):null]}),e.jsxs("div",{className:"mt-4",children:[R&&e.jsx(ie,{color:"primary",children:R}),z&&e.jsx(ie,{color:"danger",children:z})]}),e.jsx(Re,{data:m,formData:M,handleDelete:fe,handleUpdate:W,setActiveForm:f,setShowForm:x})]}),e.jsx(Te,{visible:ne,onClose:()=>P(!1),onConfirm:ge,title:ce,message:de})]})})};export{st as default};
