import{a as l,j as e,C as J}from"./index-f6D6TMGS.js";import{b as K}from"./index.esm-B7prAHhm.js";import{u as C,w as q,F as G}from"./FileSaver.min-_VtqP_qQ.js";import{a as j}from"./axios.config-D8NC-S8h.js";import{I as P,J as Q,K as U}from"./api.endpoints-D7eIfK11.js";import{M as w}from"./Modal-Byr5KNe-.js";import{h as g}from"./errorHelper-EbapN-iz.js";import{C as V,a as W}from"./CRow-C5aZ3uce.js";import{C as X,a as Y}from"./CCardBody-DyHbCEEC.js";import{C as S}from"./CCardHeader-BkEnHaV2.js";import{C as y}from"./CButton-ByJ5g7iZ.js";import{C as Z,a as ee,b as I,c as m,d as se,e as u}from"./CTable-Bj0B-88c.js";import{c as te}from"./cil-trash-CBbKHhHb.js";import{C as le}from"./CAlert-Ceafrkex.js";import"./CModalHeader-fVen3JA5.js";import"./DefaultLayout-BE9qYLzL.js";import"./cil-user-Ddrdy7PS.js";import"./CModalTitle-AQ6XSAyd.js";const we=()=>{const[o,_]=l.useState([]),[i,r]=l.useState(""),[B,p]=l.useState(!1),[b,k]=l.useState(null),[D,a]=l.useState(!1),[E,f]=l.useState(!1),[T,ne]=l.useState(!1),[t,c]=l.useState([]);l.useEffect(()=>{if(i){const s=setTimeout(()=>{r("")},3e3);return()=>clearTimeout(s)}},[i]);const d=l.useCallback(async()=>{a(),r("");try{const{data:s}=await j.get(P);_(s)}catch(s){r(g(s))}finally{a(!1)}},[]);l.useEffect(()=>{d()},[d]);const M=s=>{k(s),p(!0)},A=()=>{t.length!==0&&f(!0)},v=async()=>{if(b){a(!0),r("");try{const{data:s}=await j.delete(`${Q}/${b}`);d()}catch(s){r(g(s))}finally{p(!1),k(null),a(!1)}}},N=s=>{c(n=>n.includes(s)?n.filter(h=>h!==s):[...n,s])},$=s=>t.includes(s),H=()=>{t.length===o.length?c([]):c(o.map(s=>s.id))},L=()=>{if(t.length===0)return;const s=o.filter(x=>t.includes(x.id)).map((x,z)=>({Index:z+1,Email:x.email})),n=C.json_to_sheet(s),h=C.book_new();C.book_append_sheet(h,n,"Selected Emails");const R=q(h,{bookType:"xlsx",type:"array"}),F=new Blob([R],{type:"application/octet-stream"});G.saveAs(F,"newsletter_mails.xlsx")},O=async()=>{if(t.length!==0){a(!0);try{await j.post(`${U}`,{ids:t}),c([]),d()}catch(s){r(g(s))}finally{f(!1),a(!1)}}};return D?e.jsx(J,{color:"primary",className:"d-block mx-auto my-5"}):e.jsxs(V,{children:[e.jsx(W,{xs:12,children:e.jsxs(X,{children:[e.jsx(S,{children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("strong",{children:"Mail"})," ",e.jsx("small",{children:"Subscriptions"})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(y,{color:"success",className:"fw-normal text-white",onClick:L,disabled:t.length===0,children:"Export Mail's"}),e.jsx(y,{color:"danger",className:"fw-normal text-white",onClick:A,disabled:t.length===0,children:"Bulk Delete"})]})]})}),e.jsx(Y,{children:o.length>0?e.jsxs(Z,{hover:!0,children:[e.jsx(ee,{children:e.jsxs(I,{children:[e.jsx(m,{scope:"col",children:e.jsx("input",{type:"checkbox",checked:t.length===o.length,onChange:H})}),e.jsx(m,{scope:"col",children:"Index"}),e.jsx(m,{scope:"col",children:"Mail"}),e.jsx(m,{scope:"col",children:"Action"})]})}),e.jsx(se,{children:o.map((s,n)=>e.jsxs(I,{children:[e.jsx(u,{children:e.jsx("input",{type:"checkbox",checked:$(s.id),onChange:()=>N(s.id)})}),e.jsx(u,{children:n+1}),e.jsx(u,{children:s.email}),e.jsx(u,{children:e.jsx(y,{type:"button",color:"danger",onClick:()=>M(s.id),children:e.jsx(K,{icon:te,size:"md"})})})]},s.id))})]}):e.jsx(S,{children:e.jsx("strong",{children:"No subscriptions found."})})})]})}),i&&e.jsx(le,{children:i}),e.jsx(w,{visible:B,onClose:()=>p(!1),onConfirm:v,title:"Confirm Delete",message:"Are you sure you want to delete this newsletter?"}),e.jsx(w,{visible:E,onClose:()=>f(!1),onConfirm:O,loading:T,title:"Confirm Bulk Delete",message:`Are you sure you want to delete ${t.length} selected newsletter subscription(s)?`})]})};export{we as default};
